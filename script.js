// –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∏ –∏—Ö –∫–ª—é—á–µ–π
const users = {
    // –£—á–µ–Ω–∏–∫–∏
    'S0F1A2B3': { name: '–ê–π—Ä–∞–ø–µ—Ç—è–Ω—Ü –°–æ—Ñ–∏—è', role: '–£—á–µ–Ω–∏–∫', avatar: '–°–ê' },
    'B4G5R6T7': { name: '–ë–µ–±–∏—è –ë–∞–≥—Ä–∞—Ç', role: '–í–ª–∞–¥–µ–ª–µ—Ü —Å–∞–π—Ç–∞', avatar: '–ë–ë' },
    'D8M9T0R1': { name: '–ë–µ–ª—è–µ–≤ –î–º–∏—Ç—Ä–∏–π', role: '–£—á–µ–Ω–∏–∫', avatar: '–î–ë' },
    'A2R3T4M5': { name: '–ë–æ–∂–µ—Å–∫–∏–π –ê—Ä—Ç—ë–º', role: '–£—á–µ–Ω–∏–∫', avatar: '–ê–ë' },
    'V6E7R8O9': { name: '–ë—É–Ω–∫–æ–≤—Å–∫–∞—è –í–µ—Ä–æ–Ω–∏–∫–∞', role: '–£—á–µ–Ω–∏–∫', avatar: '–í–ë' },
    'U1L2Y3A4': { name: '–í–∞–ª–µ–µ–≤–∞ –£–ª—å—è–Ω–∞', role: '–£—á–µ–Ω–∏–∫', avatar: '–£–í' },
    'E5L6I7Z8': { name: '–í–æ—Ä–æ–±–µ–ª—å –ï–ª–∏–∑–∞–≤–µ—Ç–∞', role: '–£—á–µ–Ω–∏–∫', avatar: '–ï–í' },
    'K9A0R1I2': { name: '–ì–∞—Ç–∏–∫–æ–µ–≤–∞ –ö–∞—Ä–∏–Ω–∞', role: '–£—á–µ–Ω–∏–∫', avatar: '–ö–ì' },
    'P3O4L5I6': { name: '–ì–µ—Ä–∞—Å–∏–º–æ–≤–∞ –ü–æ–ª–∏–Ω–∞', role: '–£—á–µ–Ω–∏–∫', avatar: '–ü–ì' },
    'M7A8X9I0': { name: '–ì–æ—Ä–ª–æ–≤ –ú–∞–∫—Å–∏–º', role: '–£—á–µ–Ω–∏–∫', avatar: '–ú–ì' },
    'V1E2R3O4': { name: '–î–µ–º–∏–¥–æ–≤–∏—á –í–µ—Ä–æ–Ω–∏–∫–∞', role: '–£—á–µ–Ω–∏–∫', avatar: '–í–î' },
    'A5N6D7R8': { name: '–î—Ä—ã–±–∞–ª–æ–≤ –ê–Ω–¥—Ä–µ–π', role: '–£—á–µ–Ω–∏–∫', avatar: '–ê–î' },
    'K9I0R1A2': { name: '–ï–ª—Å—É–∫–æ–≤–∞ –ö–∏—Ä–∞', role: '–£—á–µ–Ω–∏–∫', avatar: '–ö–ï' },
    'Z3H4A5N6': { name: '–ï—Ä–º—É—Ö–∞–Ω–æ–≤ –ñ–∞–Ω–∞—Ö–º–µ–¥', role: '–£—á–µ–Ω–∏–∫', avatar: '–ñ–ï' },
    'L7I8A9N0': { name: '–ö–∞–ª–∏–Ω–∏–Ω–∞ –õ–∏–∞–Ω–∞', role: '–£—á–µ–Ω–∏–∫', avatar: '–õ–ö' },
    'E1V2G3E4': { name: '–ö–æ—á–º–∞—Ä –ï–≤–≥–µ–Ω–∏—è', role: '–£—á–µ–Ω–∏–∫', avatar: '–ï–ö' },
    'E5L6I7Z8': { name: '–õ–µ–æ–Ω—Ç—å–µ–≤–∞ –ï–ª–∏–∑–∞–≤–µ—Ç–∞', role: '–£—á–µ–Ω–∏–∫', avatar: '–ï–õ' },
    'E9L0I1Z2': { name: '–ù–∞–¥—å—è—Ä–Ω–∞—è –ï–ª–∏–∑–∞–≤–µ—Ç–∞', role: '–£—á–µ–Ω–∏–∫', avatar: '–ï–ù' },
    'K3S4E5N6': { name: '–û—á–∞–∫–æ–≤–∞ –ö—Å–µ–Ω–∏—è', role: '–£—á–µ–Ω–∏–∫', avatar: '–ö–û' },
    'A7L8I9N0': { name: '–ü—è–∂–∏–µ–≤–∞ –ê–ª–∏–Ω–∞', role: '–£—á–µ–Ω–∏–∫', avatar: '–ê–ü' },
    'K1I2R3I4': { name: '–†–∞–¥–∏–≤–∏–ª–æ–≤ –ö–∏—Ä–∏–ª–ª', role: '–£—á–µ–Ω–∏–∫', avatar: '–ö–†' },
    'G5R6I7G8': { name: '–†—ã–±–∞–∫ –ì—Ä–∏–≥–æ—Ä–∏–π', role: '–£—á–µ–Ω–∏–∫', avatar: '–ì–†' },
    'K9I0R1I2': { name: '–®–∞—Ä–∏–Ω –ö–∏—Ä–∏–ª–ª', role: '–£—á–µ–Ω–∏–∫', avatar: '–ö–®' },
    'E3K4A5T6': { name: '–®–∏–ª–æ–≤–∞ –ï–∫–∞—Ç–µ—Ä–∏–Ω–∞', role: '–£—á–µ–Ω–∏–∫', avatar: '–ï–®' },
    'P7O8L9I0': { name: '–Ø–Ω—Ü–µ–≤–∏—á –ü–æ–ª–∏–Ω–∞', role: '–£—á–µ–Ω–∏–∫', avatar: '–ü–Ø' },
    
    // –£—á–∏—Ç–µ–ª—å
    'L1A2R3I4': { name: '–ê–ª–±–∞–µ–≤–∞ –õ–∞—Ä–∏—Å–∞ –ö–∞–¥—ã—Ä–æ–≤–Ω–∞', role: '–£—á–∏—Ç–µ–ª—å', avatar: '–õ–ê' }
};

// –î–∞–Ω–Ω—ã–µ –æ –º–µ—Å—Ç–∞—Ö —Å –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞–º–∏
const placesData = {
    '–ö–æ—Ñ–µ–π–Ω—è ¬´Veranda¬ª': {
        coords: [59.900921, 29.085828],
        address: '–°–æ—Å–Ω–æ–≤—ã–π –ë–æ—Ä, –°–æ–ª–Ω–µ—á–Ω–∞—è —É–ª–∏—Ü–∞, 12, –¢–†–ö ¬´–ì–∞–ª–∞–∫—Ç–∏–∫–∞¬ª',
        description: '–ö–æ—Ñ–µ–π–Ω—è Veranda ‚Äî —ç—Ç–æ —É—é—Ç–Ω–æ–µ –º–µ—Å—Ç–æ —Å –ø—Ä–∏—è—Ç–Ω–æ–π –∞—Ç–º–æ—Å—Ñ–µ—Ä–æ–π, –≥–¥–µ –º–æ–∂–Ω–æ –ø—Ä–æ–≤–µ—Å—Ç–∏ –≤—Ä–µ–º—è –∑–∞ —á–∞—à–µ—á–∫–æ–π –∫–æ—Ñ–µ –∏–ª–∏ –∫–∞–∫–∞–æ, –∞ —Ç–∞–∫–∂–µ –Ω–∞—Å–ª–∞–¥–∏—Ç—å—Å—è –∏–∑—ã—Å–∫–∞–Ω–Ω—ã–º–∏ –¥–µ—Å–µ—Ä—Ç–∞–º–∏, —Ç–∞–∫–∏–º–∏ –∫–∞–∫ —á–∏–∑–∫–µ–π–∫ ¬´–°–∞–Ω-–°–µ–±–∞—Å—Ç—å—è–Ω¬ª –∏–ª–∏ —Ç—Ä–∞–π—Ñ–ª.',
        phone: '+7 (812) 219-15-92',
        workingHours: '–ü–Ω-–ß—Ç: 10:00‚Äì20:00, –ü—Ç-–í—Å: 10:00‚Äì21:00',
        rating: 5.0,
        reviewsCount: 953,
        price: '$$',
        features: ['Wi-Fi', '–ü–∞—Ä–∫–æ–≤–∫–∞', '–¢–µ—Ä—Ä–∞—Å–∞', '–î–æ—Å—Ç—É–ø–Ω–æ —Å –∂–∏–≤–æ—Ç–Ω—ã–º–∏', '–ë–µ—Å–ø–ª–∞—Ç–Ω–∞—è –≤–æ–¥–∞'],
        social: 'vk.com/verandacoffee'
    },
    '–†–µ—Å—Ç–æ—Ä–∞–Ω ¬´–ü—Ö–∞–ª–∏–•–∏–Ω–∫–∞–ª–∏¬ª': {
        coords: [59.897274, 29.078945],
        address: '–°–æ—Å–Ω–æ–≤—ã–π –ë–æ—Ä, –õ–µ–Ω–∏–Ω–≥—Ä–∞–¥—Å–∫–∞—è —É–ª–∏—Ü–∞, 46',
        description: '–ê—É—Ç–µ–Ω—Ç–∏—á–Ω—ã–π —Ä–µ—Å—Ç–æ—Ä–∞–Ω –≥—Ä—É–∑–∏–Ω—Å–∫–æ–π –∫—É—Ö–Ω–∏, –∏–∑–≤–µ—Å—Ç–Ω—ã–π —Å–æ—á–Ω—ã–º–∏ —Ö–∏–Ω–∫–∞–ª–∏ –∏ —Ç—Ä–∞–¥–∏—Ü–∏–æ–Ω–Ω—ã–º–∏ –±–ª—é–¥–∞–º–∏',
        phone: '+7 (812) 219-38-36',
        workingHours: '–ü–Ω-–ß—Ç: 12:00‚Äì23:00, –ü—Ç-–°–±: 12:00‚Äì03:00, –í—Å: 12:00‚Äì23:00',
        rating: 4.7,
        reviewsCount: 1444,
        price: '$$',
        features: ['–î–æ—Å—Ç–∞–≤–∫–∞ –µ–¥—ã', '–ï–¥–∞ –Ω–∞–≤—ã–Ω–æ—Å', '–û–ø–ª–∞—Ç–∞ –∫–∞—Ä—Ç–æ–π', 'Wi-Fi'],
        social: 'phali-hinkali.ru/sbr'
    },
    '–†–µ—Å—Ç–æ—Ä–∞–Ω ¬´–¢–æ–∫–∏–æ-–°–∏—Ç–∏¬ª': {
        coords: [59.880945, 29.112260],
        address: '–°–æ—Å–Ω–æ–≤—ã–π –ë–æ—Ä, –°–æ–ª–Ω–µ—á–Ω–∞—è —É–ª–∏—Ü–∞, 12, –¢–†–ö ¬´–ì–∞–ª–∞–∫—Ç–∏–∫–∞¬ª, 3 —ç—Ç–∞–∂',
        description: '–†–µ—Å—Ç–æ—Ä–∞–Ω —Å —à–∏—Ä–æ–∫–∏–º –≤—ã–±–æ—Ä–æ–º –±–ª—é–¥ —è–ø–æ–Ω—Å–∫–æ–π, –∏—Ç–∞–ª—å—è–Ω—Å–∫–æ–π, –º–µ–∫—Å–∏–∫–∞–Ω—Å–∫–æ–π –∏ –¥—Ä—É–≥–∏—Ö –∫—É—Ö–æ–Ω—å',
        phone: '+7 (812) 677-41-12',
        workingHours: '–ü–Ω-–ß—Ç: 12:00‚Äì23:00, –ü—Ç-–°–±: 12:00‚Äì01:00, –í—Å: 12:00‚Äì23:00',
        rating: 3.9,
        reviewsCount: 26,
        price: '$$',
        features: ['600+ –ø–æ–∑–∏—Ü–∏–π –≤ –º–µ–Ω—é', '–î–æ—Å—Ç–∞–≤–∫–∞', '–ë—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ', '–î–µ—Ç—Å–∫–æ–µ –º–µ–Ω—é'],
        social: 'tokyo-city.ru/spb/restaurants/sosnovyy-bor'
    },
    '–ì–∞—Å—Ç—Ä–æ–±–∞—Ä ¬´–•–µ–≤–∞–∞¬ª': {
        coords: [59.897457, 29.117188],
        address: '–°–æ—Å–Ω–æ–≤—ã–π –ë–æ—Ä, –£—Å—Ç—å–∏–Ω—Å–∫–∞—è —É–ª–∏—Ü–∞, 11/2',
        description: '–ì—Ä–∏–ª—å-–±–∞—Ä –ø—Ä–∏ –∫–æ–º–ø–ª–µ–∫—Å–µ Hevaa —Å –±–ª—é–¥–∞–º–∏ –Ω–∞ –≥—Ä–∏–ª–µ, –±—É—Ä–≥–µ—Ä–∞–º–∏, —Å—Ç–µ–π–∫–∞–º–∏ –∏ —É—é—Ç–Ω–æ–π –∞—Ç–º–æ—Å—Ñ–µ—Ä–æ–π —É –º–æ—Ä—è',
        phone: '+7 (812) 220-15-22',
        workingHours: '–ö—Ä—É–≥–ª–æ—Å—É—Ç–æ—á–Ω–æ',
        rating: 4.3,
        reviewsCount: 1213,
        price: '$$',
        features: ['–ö—Ä—É–≥–ª–æ—Å—É—Ç–æ—á–Ω–æ', '–ë–µ—Å–µ–¥–∫–∏', '–õ–µ—Ç–Ω—è—è –ø–ª–æ—â–∞–¥–∫–∞', '–ì—Ä–∏–ª—å', '–ö–æ–∫—Ç–µ–π–ª–∏'],
        social: 'hevaa.ru'
    },
    '–ì—Ä–∞–Ω–¥-–∫–∞—Ñ–µ ¬´–ë–∞–≥—Ä–∞—Ç–∏–æ–Ω¬ª': {
        coords: [59.886361, 29.117621],
        address: '–°–æ—Å–Ω–æ–≤—ã–π –ë–æ—Ä, –ü—Ä–æ—Å–ø–µ–∫—Ç –ì–µ—Ä–æ–µ–≤, 65A',
        description: '–ì—Ä–∞–Ω–¥-–∫–∞—Ñ–µ —Å —Ä–∞–∑–Ω–æ–æ–±—Ä–∞–∑–Ω–æ–π –µ–≤—Ä–æ–ø–µ–π—Å–∫–æ–π –∏ –≥—Ä—É–∑–∏–Ω—Å–∫–æ–π –∫—É—Ö–Ω–µ–π, –∂–∏–≤–æ–π –º—É–∑—ã–∫–æ–π –∏ —É—é—Ç–Ω–æ–π –∞—Ç–º–æ—Å—Ñ–µ—Ä–æ–π',
        phone: '+7 (965) 752-22-82',
        workingHours: '–ü–Ω-–ß—Ç: 11:00‚Äì23:00, –ü—Ç-–°–±: 11:00‚Äì01:00, –í—Å: 11:00‚Äì23:00',
        rating: 4.3,
        reviewsCount: 260,
        price: '$$',
        features: ['–ñ–∏–≤–∞—è –º—É–∑—ã–∫–∞', '–î–æ—Å—Ç–∞–≤–∫–∞', '–ë–µ—Å–ø–ª–∞—Ç–Ω–∞—è –ø–∞—Ä–∫–æ–≤–∫–∞', '–ï–≤—Ä–æ–ø–µ–π—Å–∫–∞—è –∫—É—Ö–Ω—è'],
        social: ''
    },
    '–ö–∏–Ω–æ—Ç–µ–∞—Ç—Ä ¬´–°–æ–≤—Ä–µ–º–µ–Ω–Ω–∏–∫¬ª': {
        coords: [59.91185, 29.07062],
        address: '–°–æ—Å–Ω–æ–≤—ã–π –ë–æ—Ä, –ö–æ–º—Å–æ–º–æ–ª—å—Å–∫–∞—è —É–ª–∏—Ü–∞, 17',
        description: '–ì–æ—Ä–æ–¥—Å–∫–æ–π –∫–∏–Ω–æ—Ç–µ–∞—Ç—Ä —Å —Å—É—à–∏-–±–∞—Ä–æ–º ¬´–ö–∏–Ω-–Ω–æ¬ª. –£–¥–æ–±–Ω—ã–µ –∫—Ä–µ—Å–ª–∞, —Ö–æ—Ä–æ—à–µ–µ –∫–∞—á–µ—Å—Ç–≤–æ –∑–≤—É–∫–∞. –ò–¥–µ–∞–ª—å–Ω–æ–µ –º–µ—Å—Ç–æ –¥–ª—è –æ—Ç–¥—ã—Ö–∞ —Å –ø—Ä–æ—Å–º–æ—Ç—Ä–æ–º —Ñ–∏–ª—å–º–æ–≤ –∏ —è–ø–æ–Ω—Å–∫–æ–π –∫—É—Ö–Ω–µ–π.',
        phone: '+7 (81369) 2-12-32',
        workingHours: '–ö–∏–Ω–æ—Ç–µ–∞—Ç—Ä: 11:00‚Äì00:00, –ë–∞—Ä ¬´–ö–∏–Ω-–Ω–æ¬ª: 12:00‚Äì02:00 (–¥–æ 03:00 –ü—Ç-–°–±)',
        rating: 3.9,
        reviewsCount: 1000,
        price: '$$',
        features: ['–°—É—à–∏-–±–∞—Ä ¬´–ö–∏–Ω-–Ω–æ¬ª', '–£–¥–æ–±–Ω—ã–µ –∫—Ä–µ—Å–ª–∞', '–•–æ—Ä–æ—à–∏–π –∑–≤—É–∫', '–ù–µ—Å–∫–æ–ª—å–∫–æ –∑–∞–ª–æ–≤', '–Ø–ø–æ–Ω—Å–∫–∞—è –∫—É—Ö–Ω–∏'],
        social: 'sovremennik.sbor.net'
    },
    '–†–µ—Å—Ç–æ—Ä–∞–Ω ¬´–î—é–Ω—ã¬ª': {
        coords: [59.878952, 29.112933],
        address: '–£–ª–∏—Ü–∞ –°–æ–∫–æ–ª–æ–≤–∞, 15, –°–æ—Å–Ω–æ–≤—ã–π –ë–æ—Ä',
        description: '–£—é—Ç–Ω—ã–π —Å–µ–º–µ–π–Ω—ã–π —Ä–µ—Å—Ç–æ—Ä–∞–Ω —Å –ø—Ä–∏–≥–ª—É—à–µ–Ω–Ω—ã–º —Å–≤–µ—Ç–æ–º –∏ —Å—Ç–∏–ª—å–Ω—ã–º –∏–Ω—Ç–µ—Ä—å–µ—Ä–æ–º, –∫–æ—Ç–æ—Ä—ã–π –ø—Ä–∏–∑–≤–∞–Ω –≤–æ–∑—Ä–æ–¥–∏—Ç—å –∞—Ç–º–æ—Å—Ñ–µ—Ä—É –∏—Å—Ç–æ—Ä–∏–∏ –≥–æ—Ä–æ–¥–∞ –°–æ—Å–Ω–æ–≤—ã–π –ë–æ—Ä.',
        phone: '+7 (921) 888-88-35',
        workingHours: '–ü–Ω-–ß—Ç, –í—Å: 12:30‚Äì00:00<br>–ü—Ç-–°–±: 12:30‚Äì02:00',
        rating: 4.3,
        reviewsCount: 127,
        price: '$$',
        features: ['Wi-Fi', '–î–µ—Ç—Å–∫–∞—è –∫–æ–º–Ω–∞—Ç–∞', '–î–µ—Ç—Å–∫–æ–µ –º–µ–Ω—é', '–ü—Ä–æ–≤–µ–¥–µ–Ω–∏–µ —Å–≤–∞–¥–µ–±', '–ü–∞—Ä–∫–æ–≤–∫–∞'],
        social: 'vk.com/dune_rest',
        category: 'restaurant'
    },
    '–ö–∞—Ñ–µ ¬´–†–∞–¥—É–≥–∞¬ª': {
        coords: [59.875323, 29.071060],
        address: '–£–ª–∏—Ü–∞ –ö—Ä–∞—Å–Ω—ã—Ö –§–æ—Ä—Ç–æ–≤, 11, –°–æ—Å–Ω–æ–≤—ã–π –ë–æ—Ä',
        description: '–£—é—Ç–Ω–æ–µ –∏ –Ω–µ–¥–æ—Ä–æ–≥–æ–µ –∫–∞—Ñ–µ, –≥–¥–µ –ø–æ–¥–∞—é—Ç –±–ª—é–¥–∞ –¥–æ–º–∞—à–Ω–µ–π –∫—É—Ö–Ω–∏, –≤ —Ç–æ–º —á–∏—Å–ª–µ –∫–æ–º–ø–ª–µ–∫—Å–Ω—ã–µ –æ–±–µ–¥—ã.',
        phone: '+7 (81369) 4-26-15',
        workingHours: '–ï–∂–µ–¥–Ω–µ–≤–Ω–æ: 08:30‚Äì19:30<br>–ü–µ—Ä–µ—Ä—ã–≤: 15:00‚Äì16:00',
        rating: 4.4,
        reviewsCount: 427,
        price: '$',
        features: ['–ë–∏–∑–Ω–µ—Å-–ª–∞–Ω—á', '–ü–æ–º–∏–Ω–∞–ª—å–Ω—ã–µ –æ–±–µ–¥—ã', '–ü—Ä–æ–≤–µ–¥–µ–Ω–∏–µ –±–∞–Ω–∫–µ—Ç–æ–≤', '–ó–∞–∫–∞–∑ –Ω–∞–≤—ã–Ω–æ—Å'],
        social: 'vk.com/raduganiti',
        category: 'cafe'
    },
    '–†–µ—Å—Ç–æ—Ä–∞–Ω ¬´–ú–æ–π –°–æ—Å–Ω–æ–≤—ã–π –ë–æ—Ä¬ª': {
        coords: [59.880945, 29.112260],
        address: '–°–æ–ª–Ω–µ—á–Ω–∞—è —É–ª–∏—Ü–∞, 9, –°–æ—Å–Ω–æ–≤—ã–π –ë–æ—Ä',
        description: '–†–µ—Å—Ç–æ—Ä–∞–Ω –µ–≤—Ä–æ–ø–µ–π—Å–∫–æ–π –∫—É—Ö–Ω–∏ —Å —É—é—Ç–Ω—ã–º –∏–Ω—Ç–µ—Ä—å–µ—Ä–æ–º, –ø–æ–¥—Ö–æ–¥—è—â–∏–π –∫–∞–∫ –¥–ª—è –∑–∞–≤—Ç—Ä–∞–∫–æ–≤ –∏ –±–∏–∑–Ω–µ—Å-–ª–∞–Ω—á–µ–π, —Ç–∞–∫ –∏ –¥–ª—è –ø—Ä–æ–≤–µ–¥–µ–Ω–∏—è –±–∞–Ω–∫–µ—Ç–æ–≤.',
        phone: '+7 (921) 882-40-02',
        workingHours: '–ü–Ω-–ß—Ç, –í—Å: 12:00‚Äì23:00<br>–ü—Ç-–°–±: 12:00‚Äì00:00',
        rating: 4.5,
        reviewsCount: 289,
        price: '$$',
        features: ['Wi-Fi', '–ë–∏–∑–Ω–µ—Å-–ª–∞–Ω—á', '–ó–∞–≤—Ç—Ä–∞–∫', '–í–∏–Ω–Ω–∞—è –∫–∞—Ä—Ç–∞', '–ü—Ä–æ–≤–µ–¥–µ–Ω–∏–µ –±–∞–Ω–∫–µ—Ç–æ–≤', '–ó–∞–∫–∞–∑ –Ω–∞–≤—ã–Ω–æ—Å', '–ú–æ–∂–Ω–æ —Å –Ω–æ—É—Ç–±—É–∫–æ–º'],
        social: 'vk.com/msb_rest',
        category: 'restaurant'
    },
    '–°—Ç—Ä–∏—Ç—Ñ—É–¥ ¬´–ú–æ–π –°–æ—Å–Ω–æ–≤—ã–π –ë–æ—Ä¬ª': {
        coords: [59.904453, 29.071661],
        address: '–ü—Ä–∏–º–æ—Ä—Å–∫–∏–π –ø–∞—Ä–∫, –°–æ—Å–Ω–æ–≤—ã–π –ë–æ—Ä',
        description: '–ù–µ–±–æ–ª—å—à–æ–µ –∫–∞—Ñ–µ —Å –±–ª—é–¥–∞–º–∏ —É–ª–∏—á–Ω–æ–π –µ–¥—ã, —Ä–∞—Å–ø–æ–ª–æ–∂–µ–Ω–Ω–æ–µ –≤ –ü—Ä–∏–º–æ—Ä—Å–∫–æ–º –ø–∞—Ä–∫–µ, –≤–±–ª–∏–∑–∏ –§–∏–Ω—Å–∫–æ–≥–æ –∑–∞–ª–∏–≤–∞.',
        phone: '+7 (931) 370-70-00',
        workingHours: '–ï–∂–µ–¥–Ω–µ–≤–Ω–æ: 11:00‚Äì22:00',
        rating: 4.8,
        reviewsCount: 2104,
        price: '$',
        features: ['–ï–¥–∞ –Ω–∞–≤—ã–Ω–æ—Å', '–†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ –≤ –ø–∞—Ä–∫–µ', '–†—è–¥–æ–º —Å –∑–∞–ª–∏–≤–æ–º'],
        social: 'vk.com/msb_park',
        category: 'cafe'
    }
};

// –î–∞–Ω–Ω—ã–µ —Å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è–º–∏ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –∑–∞–≤–µ–¥–µ–Ω–∏—è
const placeImages = {
    '–ö–æ—Ñ–µ–π–Ω—è ¬´Veranda¬ª': [
        'https://avatars.mds.yandex.net/get-altay/13054604/2a00000190a77560adb2066c2b0ff460732b/XXXL',
        'https://avatars.mds.yandex.net/get-altay/14014620/2a000001912c9dca1b4e62d778d484446b94/XXXL',
        'https://avatars.mds.yandex.net/get-altay/5456504/2a0000017c7ea8dd69a6f7b112b5640b870d/XXXL'
    ],
    '–†–µ—Å—Ç–æ—Ä–∞–Ω ¬´–ü—Ö–∞–ª–∏–•–∏–Ω–∫–∞–ª–∏¬ª': [
        'https://example.com/phali-dishes.jpg',
        'https://example.com/phali-interior.jpg',
        'https://example.com/phali-hinkali.jpg'
    ],
    '–†–µ—Å—Ç–æ—Ä–∞–Ω ¬´–¢–æ–∫–∏–æ-–°–∏—Ç–∏¬ª': [
        'https://example.com/tokyo-interior.jpg',
        'https://example.com/tokyo-sushi.jpg'
    ],
    '–ì—Ä–∞–Ω–¥-–∫–∞—Ñ–µ ¬´–ë–∞–≥—Ä–∞—Ç–∏–æ–Ω¬ª': [
        'https://example.com/bagration-hall.jpg',
        'https://example.com/bagration-food.jpg'
    ],
    '–ì–∞—Å—Ç—Ä–æ–±–∞—Ä ¬´–•–µ–≤–∞–∞¬ª': [
        'https://example.com/hevaa-terrace.jpg',
        'https://example.com/hevaa-grill.jpg',
        'https://example.com/hevaa-cocktails.jpg'
    ],
    '–ö–∏–Ω–æ—Ç–µ–∞—Ç—Ä ¬´–°–æ–≤—Ä–µ–º–µ–Ω–Ω–∏–∫¬ª': [
        'https://example.com/sovremennik-building.jpg',
        'https://example.com/sovremennik-hall.jpg',
        'https://example.com/sovremennik-bar.jpg'
    ],
    '–†–µ—Å—Ç–æ—Ä–∞–Ω ¬´–î—é–Ω—ã¬ª': [
        'https://avatars.mds.yandex.net/get-altay/10664848/2a0000017dfb9b5c49e3e56e12b3c3a8a6e1/XXXL'
    ],
    '–ö–∞—Ñ–µ ¬´–†–∞–¥—É–≥–∞¬ª': [
        'https://avatars.mds.yandex.net/get-altay/988708/2a00000161c09c5c9a4a5d9d4e5d8b8a8a2e/XXXL'
    ],
    '–†–µ—Å—Ç–æ—Ä–∞–Ω ¬´–ú–æ–π –°–æ—Å–Ω–æ–≤—ã–π –ë–æ—Ä¬ª': [
        'https://example.com/msb-restaurant-interior.jpg',
        'https://example.com/msb-restaurant-food.jpg'
    ],
    '–°—Ç—Ä–∏—Ç—Ñ—É–¥ ¬´–ú–æ–π –°–æ—Å–Ω–æ–≤—ã–π –ë–æ—Ä¬ª': [
        'https://example.com/msb-streetfood-park.jpg',
        'https://example.com/msb-streetfood-dishes.jpg'
    ]
};

// DOM —ç–ª–µ–º–µ–Ω—Ç—ã
const loginScreen = document.getElementById('login-screen');
const mainContent = document.getElementById('main-content');
const accessKeyInput = document.getElementById('access-key');
const loginBtn = document.getElementById('login-btn');
const userInfo = document.getElementById('user-info');
const userAvatar = document.getElementById('user-avatar');
const userName = document.getElementById('user-name');
const userRole = document.getElementById('user-role');
const welcomeName = document.getElementById('welcome-name');
const logoutBtn = document.getElementById('logout-btn');

// –≠–ª–µ–º–µ–Ω—Ç—ã –∫–∞—Ä—Ç—ã
const mapModal = document.getElementById('map-modal');
const mapContainer = document.getElementById('map-container');
const mapPlaceTitle = document.getElementById('map-place-title');
const mapAddressText = document.getElementById('map-address-text');
const closeMapModal = document.getElementById('close-map-modal');

// –≠–ª–µ–º–µ–Ω—Ç—ã –¥–ª—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
const imageModal = document.getElementById('image-modal');
const fullscreenImage = document.getElementById('fullscreen-image');
const imageModalTitle = document.getElementById('image-modal-title');
const closeImageModal = document.getElementById('close-image-modal');
const prevImageBtn = document.getElementById('prev-image');
const nextImageBtn = document.getElementById('next-image');
const currentImageElement = document.getElementById('current-image');
const totalImagesElement = document.getElementById('total-images');

// –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è–º–∏
let currentImages = [];
let currentImageIndex = 0;
let currentPlaceName = '';

// –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –∫–∞—Ä—Ç—ã
let ymap = null;
let currentPlace = null;

// –°–∏—Å—Ç–µ–º–∞ –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏—è
let votingData = {};
let currentUserKey = '';

// ================== FIREBASE –§–£–ù–ö–¶–ò–ò ==================

// –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏—è –∏–∑ Firebase
function loadVotingDataFromFirebase() {
    try {
        console.log('üîÑ –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –∏–∑ Firebase...');
        const votesRef = window.db.ref('votes');
        votesRef.on('value', (snapshot) => {
            const data = snapshot.val();
            console.log('üìä –î–∞–Ω–Ω—ã–µ –ø–æ–ª—É—á–µ–Ω—ã –∏–∑ Firebase:', data);
            
            // –í–ê–ñ–ù–û: –ù–æ—Ä–º–∞–ª–∏–∑—É–µ–º —Å—Ç—Ä—É–∫—Ç—É—Ä—É –¥–∞–Ω–Ω—ã—Ö
            votingData = {};
            if (data && typeof data === 'object') {
                Object.keys(data).forEach(key => {
                    const userData = data[key];
                    if (userData && typeof userData === 'object') {
                        // –ì–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ–º, —á—Ç–æ votedFor –≤—Å–µ–≥–¥–∞ –º–∞—Å—Å–∏–≤
                        votingData[key] = {
                            name: userData.name || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π',
                            role: userData.role || '–£—á–µ–Ω–∏–∫',
                            avatar: userData.avatar || '?',
                            votedFor: Array.isArray(userData.votedFor) ? userData.votedFor : []
                        };
                    }
                });
            }
            
            console.log('üìà votingData –ø–æ—Å–ª–µ –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏–∏:', votingData);
            renderVotingResults();
            updateVoteButtons();
        }, (error) => {
            console.error('‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∏–∑ Firebase:', error);
            showNotification('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏—è', 'error');
        });
    } catch (error) {
        console.error('‚ùå –û—à–∏–±–∫–∞ –≤ loadVotingDataFromFirebase:', error);
    }
}

// –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≥–æ–ª–æ—Å–∞ –≤ Firebase
function saveVoteToFirebase(userKey, voteData) {
    return new Promise((resolve) => {
        try {
            const updates = {};
            updates['votes/' + userKey] = voteData;
            
            console.log('üíæ –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ Firebase:', updates);
            
            window.db.ref().update(updates)
                .then(() => {
                    console.log('‚úÖ –£—Å–ø–µ—à–Ω–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–æ –≤ Firebase');
                    resolve(true);
                })
                .catch((error) => {
                    console.error('‚ùå –û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –≤ Firebase:', error);
                    showNotification('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –≥–æ–ª–æ—Å–∞', 'error');
                    resolve(false);
                });
        } catch (error) {
            console.error('‚ùå –û—à–∏–±–∫–∞ –≤ saveVoteToFirebase:', error);
            resolve(false);
        }
    });
}

// –û–±–Ω–æ–≤–ª–µ–Ω–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏—è
async function handleVote(placeName) {
    console.log('üó≥Ô∏è –ù–∞—á–∞–ª–æ –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏—è –∑–∞:', placeName, '–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å:', currentUserKey);
    
    if (!currentUserKey) {
        showNotification('–î–ª—è –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏—è –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –≤–æ–π—Ç–∏ –≤ —Å–∏—Å—Ç–µ–º—É', 'error');
        return;
    }
    
    const currentUser = users[currentUserKey];
    if (!currentUser) {
        showNotification('–û—à–∏–±–∫–∞: –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω', 'error');
        return;
    }
    
    try {
        // –ì–ê–†–ê–ù–¢–ò–†–£–ï–ú, —á—Ç–æ votedFor –≤—Å–µ–≥–¥–∞ –º–∞—Å—Å–∏–≤
        const currentUserData = votingData[currentUserKey];
        const userVotes = currentUserData && Array.isArray(currentUserData.votedFor) 
            ? [...currentUserData.votedFor] 
            : [];
        
        const hasVoted = userVotes.includes(placeName);
        
        let newVotes;
        if (hasVoted) {
            // –£–±–∏—Ä–∞–µ–º –≥–æ–ª–æ—Å
            newVotes = userVotes.filter(place => place !== placeName);
            showNotification(`–ì–æ–ª–æ—Å –∑–∞ "${placeName}" –æ—Ç–º–µ–Ω–µ–Ω`, 'success');
        } else {
            // –î–æ–±–∞–≤–ª—è–µ–º –≥–æ–ª–æ—Å
            newVotes = [...userVotes, placeName];
            showNotification(`–í—ã –ø—Ä–æ–≥–æ–ª–æ—Å–æ–≤–∞–ª–∏ –∑–∞ "${placeName}"! üëç`, 'success');
        }
        
        // –°–æ–∑–¥–∞–µ–º –æ–±—ä–µ–∫—Ç –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Å –≥–∞—Ä–∞–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ–π —Å—Ç—Ä—É–∫—Ç—É—Ä–æ–π
        const voteData = {
            name: currentUser.name,
            role: currentUser.role,
            avatar: currentUser.avatar,
            votedFor: newVotes
        };
        
        console.log('üìù –ù–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è:', voteData);
        
        // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ Firebase
        const success = await saveVoteToFirebase(currentUserKey, voteData);
        
        if (success) {
            // –û–±–Ω–æ–≤–ª—è–µ–º –ª–æ–∫–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
            votingData[currentUserKey] = voteData;
            console.log('üîÑ –õ–æ–∫–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –æ–±–Ω–æ–≤–ª–µ–Ω—ã:', votingData);
            
            // –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –æ–±–Ω–æ–≤–ª—è–µ–º UI
            renderVotingResults();
            updateVoteButtons();
        }
        
    } catch (error) {
        console.error('‚ùå –û—à–∏–±–∫–∞ –≤ handleVote:', error);
        showNotification('–û—à–∏–±–∫–∞ –ø—Ä–∏ –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏–∏', 'error');
    }
}

// –û–±–Ω–æ–≤–ª–µ–Ω–Ω–∞—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å–∏—Å—Ç–µ–º—ã –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏—è
function initVotingSystem() {
    console.log('üöÄ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å–∏—Å—Ç–µ–º—ã –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏—è...');
    console.log('üîë currentUserKey –ø—Ä–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏:', currentUserKey);
    votingData = {}; // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –¥–∞–Ω–Ω—ã–µ
    loadVotingDataFromFirebase(); // –ó–∞–≥—Ä—É–∂–∞–µ–º –∑–∞–Ω–æ–≤–æ
    setupVotingButtons();
    setupVotesSearch();
}

// ================== –û–ë–ù–û–í–õ–ï–ù–ù–ê–Ø –î–ò–ê–ì–†–ê–ú–ú–ê ==================

// –†–µ–Ω–¥–µ—Ä–∏–Ω–≥ –¥–∏–∞–≥—Ä–∞–º–º—ã - –ì–û–†–ò–ó–û–ù–¢–ê–õ–¨–ù–ê–Ø –î–ò–ê–ì–†–ê–ú–ú–ê –° –ù–ê–ó–í–ê–ù–ò–Ø–ú–ò –í–ù–£–¢–†–ò –°–¢–û–õ–ë–¶–û–í
function renderChart() {
    const canvas = document.getElementById('votes-chart');
    if (!canvas) {
        console.log('‚ùå Canvas –Ω–µ –Ω–∞–π–¥–µ–Ω');
        return;
    }
    
    const ctx = canvas.getContext('2d');
    const container = canvas.parentElement;
    
    // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ä–∞–∑–º–µ—Ä—ã canvas
    canvas.width = container.clientWidth;
    canvas.height = 400;
    
    // –û—á–∏—â–∞–µ–º canvas
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    
    console.log('üé® –†–µ–Ω–¥–µ—Ä–∏–º –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω—É—é –¥–∏–∞–≥—Ä–∞–º–º—É —Å votingData:', votingData);
    
    // –°—á–∏—Ç–∞–µ–º –≥–æ–ª–æ—Å–∞ —Å –∑–∞—â–∏—Ç–æ–π –æ—Ç –æ—à–∏–±–æ–∫
    const voteCounts = {};
    
    if (votingData && typeof votingData === 'object') {
        Object.values(votingData).forEach(user => {
            if (user && Array.isArray(user.votedFor)) {
                user.votedFor.forEach(place => {
                    if (place) {
                        voteCounts[place] = (voteCounts[place] || 0) + 1;
                    }
                });
            }
        });
    }
    
    console.log('üìä –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ–¥—Å—á–µ—Ç–∞:', voteCounts);
    
    // –°–æ—Ä—Ç–∏—Ä—É–µ–º –ø–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤—É –≥–æ–ª–æ—Å–æ–≤ (–ø–æ —É–±—ã–≤–∞–Ω–∏—é)
    const sortedPlaces = Object.entries(voteCounts)
        .sort(([,a], [,b]) => b - a);
    
    // –û–±–Ω–æ–≤–ª—è–µ–º –æ–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –≥–æ–ª–æ—Å–æ–≤
    const totalVotes = Object.values(voteCounts).reduce((sum, count) => sum + count, 0);
    const totalVotesElement = document.getElementById('total-votes-count');
    if (totalVotesElement) {
        totalVotesElement.textContent = totalVotes;
    }
    
    if (sortedPlaces.length === 0) {
        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –∫–æ–≥–¥–∞ –Ω–µ—Ç –≥–æ–ª–æ—Å–æ–≤
        ctx.fillStyle = getComputedStyle(document.documentElement).getPropertyValue('--text-secondary');
        ctx.font = '16px Inter';
        ctx.textAlign = 'center';
        ctx.fillText('–ü–æ–∫–∞ –Ω–µ—Ç –≥–æ–ª–æ—Å–æ–≤. –ë—É–¥—å—Ç–µ –ø–µ—Ä–≤—ã–º!', canvas.width / 2, canvas.height / 2);
        return;
    }
    
    const maxVotes = Math.max(...Object.values(voteCounts));
    
    // –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –¥–ª—è –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ–π –¥–∏–∞–≥—Ä–∞–º–º—ã
    const padding = { top: 60, right: 150, bottom: 60, left: 20 }; // –£–≤–µ–ª–∏—á–∏–ª–∏ –ø—Ä–∞–≤—ã–π –æ—Ç—Å—Ç—É–ø
    const chartWidth = canvas.width - padding.left - padding.right;
    const chartHeight = canvas.height - padding.top - padding.bottom;
    const barHeight = 35;
    const barSpacing = 15;
    
    // –§–æ–Ω –¥–ª—è –≤—Å–µ–π –¥–∏–∞–≥—Ä–∞–º–º—ã
    ctx.fillStyle = 'rgba(255, 255, 255, 0.02)';
    ctx.fillRect(0, 0, canvas.width, canvas.height);
    
    // –†–∏—Å—É–µ–º –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω—ã–µ –±–∞—Ä—ã
    sortedPlaces.forEach(([place, votes], index) => {
        const y = padding.top + index * (barHeight + barSpacing);
        const barWidth = (votes / maxVotes) * chartWidth;
        
        // –ì—Ä–∞–¥–∏–µ–Ω—Ç –¥–ª—è –±–∞—Ä–∞
        const gradient = ctx.createLinearGradient(padding.left, y, padding.left + barWidth, y);
        gradient.addColorStop(0, '#ff6b35');
        gradient.addColorStop(1, '#ff8c5a');
        
        // –ë–∞—Ä
        ctx.fillStyle = gradient;
        roundRect(ctx, padding.left, y, barWidth, barHeight, 8);
        
        // –¢–µ–Ω—å
        ctx.shadowColor = 'rgba(255, 107, 53, 0.3)';
        ctx.shadowBlur = 10;
        ctx.shadowOffsetX = 5;
        roundRect(ctx, padding.left, y, barWidth, barHeight, 8);
        ctx.shadowColor = 'transparent';
        
        // –ù–∞–∑–≤–∞–Ω–∏–µ –º–µ—Å—Ç–∞ –í–ù–£–¢–†–ò –±–∞—Ä–∞ (—Å–ª–µ–≤–∞)
        const shortName = getShortPlaceName(place);
        ctx.fillStyle = 'white';
        ctx.font = 'bold 14px Inter';
        ctx.textAlign = 'left';
        ctx.textBaseline = 'middle';
        
        // –û–±—Ä–µ–∑–∞–µ–º –Ω–∞–∑–≤–∞–Ω–∏–µ –µ—Å–ª–∏ —Å–ª–∏—à–∫–æ–º –¥–ª–∏–Ω–Ω–æ–µ
        let displayName = shortName;
        const maxNameWidth = barWidth - 120; // –û—Å—Ç–∞–≤–ª—è–µ–º –º–µ—Å—Ç–æ –¥–ª—è –ø—Ä–æ—Ü–µ–Ω—Ç–æ–≤ –∏ –≥–æ–ª–æ—Å–æ–≤
        let textWidth = ctx.measureText(displayName).width;
        
        if (textWidth > maxNameWidth && barWidth > 150) {
            while (textWidth > maxNameWidth && displayName.length > 8) {
                displayName = displayName.substring(0, displayName.length - 1);
                textWidth = ctx.measureText(displayName + '...').width;
            }
            displayName = displayName + '...';
        }
        
        // –†–∏—Å—É–µ–º –Ω–∞–∑–≤–∞–Ω–∏–µ —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –±–∞—Ä –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —à–∏—Ä–æ–∫
        if (barWidth > 100) {
            ctx.fillText(displayName, padding.left + 10, y + barHeight / 2);
        }
        
        // –ü—Ä–æ—Ü–µ–Ω—Ç –≥–æ–ª–æ—Å–æ–≤ –í–ù–£–¢–†–ò –±–∞—Ä–∞ (—Å–ø—Ä–∞–≤–∞) - —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –µ—Å—Ç—å –º–µ—Å—Ç–æ
        const percentage = totalVotes > 0 ? ((votes / totalVotes) * 100).toFixed(1) : 0;
        ctx.fillStyle = 'white';
        ctx.font = 'bold 14px Inter';
        ctx.textAlign = 'right';
        
        // –ü–æ–∑–∏—Ü–∏–æ–Ω–∏—Ä—É–µ–º –ø—Ä–æ—Ü–µ–Ω—Ç—ã –≤–Ω—É—Ç—Ä–∏ –±–∞—Ä–∞, –µ—Å–ª–∏ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –º–µ—Å—Ç–∞
        if (barWidth > 150) {
            ctx.fillText(`${percentage}%`, padding.left + barWidth - 10, y + barHeight / 2);
        }
        
        // –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –≥–æ–ª–æ—Å–æ–≤ –í–°–ï–ì–î–ê –°–ü–†–ê–í–ê –û–¢ –ë–ê–†–ê
        ctx.fillStyle = getComputedStyle(document.documentElement).getPropertyValue('--text-secondary');
        ctx.font = '12px Inter';
        ctx.textAlign = 'left';
        ctx.textBaseline = 'middle';
        
        // –ü–æ–∑–∏—Ü–∏—è —Å–ø—Ä–∞–≤–∞ –æ—Ç –±–∞—Ä–∞ + –æ—Ç—Å—Ç—É–ø
        const votesText = `${votes} –≥–æ–ª–æ—Å–æ–≤`;
        const votesX = padding.left + chartWidth + 10;
        
        ctx.fillText(votesText, votesX, y + barHeight / 2);
        
        // –ï—Å–ª–∏ –ø—Ä–æ—Ü–µ–Ω—Ç—ã –Ω–µ –ø–æ–º–µ—Å—Ç–∏–ª–∏—Å—å –≤–Ω—É—Ç—Ä–∏ –±–∞—Ä–∞, –ø–æ–∫–∞–∑—ã–≤–∞–µ–º –∏—Ö —Å–ø—Ä–∞–≤–∞
        if (barWidth <= 150) {
            ctx.fillStyle = 'white';
            ctx.font = 'bold 12px Inter';
            ctx.textAlign = 'left';
            ctx.fillText(`${percentage}%`, votesX, y + barHeight / 2 - 8);
            
            // –°–¥–≤–∏–≥–∞–µ–º –≥–æ–ª–æ—Å–∞ –Ω–∏–∂–µ
            ctx.fillStyle = getComputedStyle(document.documentElement).getPropertyValue('--text-secondary');
            ctx.font = '12px Inter';
            ctx.fillText(votesText, votesX, y + barHeight / 2 + 8);
        }
    });
    
    // –û—Å—å X (–∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –≥–æ–ª–æ—Å–æ–≤)
    ctx.strokeStyle = getComputedStyle(document.documentElement).getPropertyValue('--border');
    ctx.lineWidth = 1;
    ctx.beginPath();
    ctx.moveTo(padding.left, padding.top);
    ctx.lineTo(padding.left + chartWidth, padding.top);
    ctx.stroke();
    
    // –ó–∞—Å–µ—á–∫–∏ –Ω–∞ –æ—Å–∏ X
    for (let i = 0; i <= 5; i++) {
        const x = padding.left + (i / 5) * chartWidth;
        const value = Math.round((i / 5) * maxVotes);
        
        ctx.strokeStyle = getComputedStyle(document.documentElement).getPropertyValue('--border');
        ctx.lineWidth = 1;
        ctx.beginPath();
        ctx.moveTo(x, padding.top - 5);
        ctx.lineTo(x, padding.top);
        ctx.stroke();
        
        ctx.fillStyle = getComputedStyle(document.documentElement).getPropertyValue('--text-secondary');
        ctx.font = '12px Inter';
        ctx.textAlign = 'center';
        ctx.textBaseline = 'bottom';
        ctx.fillText(value, x, padding.top - 8);
    }
    
    // –ó–∞–≥–æ–ª–æ–≤–æ–∫
    ctx.fillStyle = getComputedStyle(document.documentElement).getPropertyValue('--text-primary');
    ctx.font = 'bold 16px Inter';
    ctx.textAlign = 'center';
    ctx.fillText('–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏—è', canvas.width / 2, 30);
}

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –∫–æ—Ä–æ—Ç–∫–æ–≥–æ –Ω–∞–∑–≤–∞–Ω–∏—è –º–µ—Å—Ç–∞ (—É–±–∏—Ä–∞–µ–º "–ö–æ—Ñ–µ–π–Ω—è", "–†–µ—Å—Ç–æ—Ä–∞–Ω" –∏ —Ç.–¥.)
function getShortPlaceName(fullName) {
    // –£–±–∏—Ä–∞–µ–º –ø—Ä–µ—Ñ–∏–∫—Å—ã —Ç–∏–ø–∞ "–ö–æ—Ñ–µ–π–Ω—è", "–†–µ—Å—Ç–æ—Ä–∞–Ω", "–ö–∞—Ñ–µ-–ø–µ–∫–∞—Ä–Ω—è" –∏ —Ç.–¥.
    const prefixes = [
        '–ö–æ—Ñ–µ–π–Ω—è',
        '–†–µ—Å—Ç–æ—Ä–∞–Ω', 
        '–ö–∞—Ñ–µ-–ø–µ–∫–∞—Ä–Ω—è',
        '–ì—Ä–∞–Ω–¥-–∫–∞—Ñ–µ',
        '–ì–∞—Å—Ç—Ä–æ–±–∞—Ä',
        '–ö–∏–Ω–æ—Ç–µ–∞—Ç—Ä',
        '–ö–∞—Ñ–µ'
    ];
    
    let shortName = fullName;
    
    // –£–±–∏—Ä–∞–µ–º –∫–∞–≤—ã—á–∫–∏ ¬´¬ª
    shortName = shortName.replace(/¬´|¬ª/g, '');
    
    // –£–±–∏—Ä–∞–µ–º –ø—Ä–µ—Ñ–∏–∫—Å—ã
    for (const prefix of prefixes) {
        if (shortName.startsWith(prefix)) {
            shortName = shortName.substring(prefix.length).trim();
            break;
        }
    }
    
    // –£–±–∏—Ä–∞–µ–º –ª–∏—à–Ω–∏–µ –ø—Ä–æ–±–µ–ª—ã –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ–º
    return shortName.trim() || fullName;
}

// –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è —Å–∫—Ä—É–≥–ª–µ–Ω–Ω—ã—Ö –ø—Ä—è–º–æ—É–≥–æ–ª—å–Ω–∏–∫–æ–≤
function roundRect(ctx, x, y, width, height, radius) {
    ctx.beginPath();
    ctx.moveTo(x + radius, y);
    ctx.lineTo(x + width - radius, y);
    ctx.quadraticCurveTo(x + width, y, x + width, y + radius);
    ctx.lineTo(x + width, y + height - radius);
    ctx.quadraticCurveTo(x + width, y + height, x + width - radius, y + height);
    ctx.lineTo(x + radius, y + height);
    ctx.quadraticCurveTo(x, y + height, x, y + height - radius);
    ctx.lineTo(x, y + radius);
    ctx.quadraticCurveTo(x, y, x + radius, y);
    ctx.closePath();
    ctx.fill();
}

// ================== –°–ò–°–¢–ï–ú–ê –£–ü–†–ê–í–õ–ï–ù–ò–Ø –ö–ê–†–¢–û–ß–ö–ê–ú–ò ==================

// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫–∞—Ä—Ç–æ—á–∫–∞–º–∏ –¥–ª—è –≤–ª–∞–¥–µ–ª—å—Ü–∞
function initCardManagement() {
    const currentUser = users[currentUserKey];
    if (currentUser && currentUser.role === '–í–ª–∞–¥–µ–ª–µ—Ü —Å–∞–π—Ç–∞') {
        addManagementInterface();
        // –î–æ–±–∞–≤–ª—è–µ–º –∫–Ω–æ–ø–∫–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ DOM
        setTimeout(addManagementButtons, 1000);
    }
}

// –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è
function addManagementInterface() {
    // –î–æ–±–∞–≤–ª—è–µ–º –∫–Ω–æ–ø–∫—É —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –≤ –Ω–∞–≤–±–∞—Ä
    const navbar = document.querySelector('.navbar');
    const manageBtn = document.createElement('button');
    manageBtn.className = 'logout-btn management-btn';
    manageBtn.innerHTML = '<i class="fas fa-plus"></i> –î–æ–±–∞–≤–∏—Ç—å –º–µ—Å—Ç–æ';
    manageBtn.style.marginLeft = '1rem';
    manageBtn.onclick = showAddPlaceModal;
    
    navbar.querySelector('.nav-user').appendChild(manageBtn);
}

// –§—É–Ω–∫—Ü–∏–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∫–∞—Ä—Ç–æ—á–∫–∞–º–∏ –¥–ª—è –≤–ª–∞–¥–µ–ª—å—Ü–∞
function addManagementButtons() {
    const currentUser = users[currentUserKey];
    if (currentUser && currentUser.role === '–í–ª–∞–¥–µ–ª–µ—Ü —Å–∞–π—Ç–∞') {
        // –î–æ–±–∞–≤–ª—è–µ–º –∫–Ω–æ–ø–∫–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –Ω–∞ –∫–∞—Å—Ç–æ–º–Ω—ã–µ –∫–∞—Ä—Ç–æ—á–∫–∏
        document.querySelectorAll('.place-card').forEach(card => {
            const placeName = card.querySelector('.card-title').textContent;
            const placeData = placesData[placeName];
            
            if (placeData && placeData.isCustom) {
                // –î–æ–±–∞–≤–ª—è–µ–º –∫–Ω–æ–ø–∫–∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è
                const managementDiv = document.createElement('div');
                managementDiv.className = 'card-management';
                managementDiv.style.cssText = `
                    position: absolute;
                    top: 10px;
                    left: 10px;
                    display: flex;
                    gap: 5px;
                    z-index: 20;
                `;
                
                const editBtn = document.createElement('button');
                editBtn.innerHTML = '<i class="fas fa-edit"></i>';
                editBtn.title = '–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å';
                editBtn.style.cssText = `
                    background: var(--warning);
                    color: black;
                    border: none;
                    border-radius: 5px;
                    width: 30px;
                    height: 30px;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    cursor: pointer;
                    font-size: 12px;
                `;
                editBtn.onclick = (e) => {
                    e.stopPropagation();
                    editPlace(placeName);
                };
                
                const deleteBtn = document.createElement('button');
                deleteBtn.innerHTML = '<i class="fas fa-trash"></i>';
                deleteBtn.title = '–£–¥–∞–ª–∏—Ç—å';
                deleteBtn.style.cssText = `
                    background: var(--error);
                    color: white;
                    border: none;
                    border-radius: 5px;
                    width: 30px;
                    height: 30px;
                    display: flex;
                    align-items: center;
                    justify-content: center;
                    cursor: pointer;
                    font-size: 12px;
                `;
                deleteBtn.onclick = (e) => {
                    e.stopPropagation();
                    deletePlace(placeName);
                };
                
                managementDiv.appendChild(editBtn);
                managementDiv.appendChild(deleteBtn);
                
                const cardHeader = card.querySelector('.card-header');
                cardHeader.style.position = 'relative';
                cardHeader.appendChild(managementDiv);
            }
        });
    }
}

// –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –º–µ—Å—Ç–∞
function editPlace(placeName) {
    const placeData = placesData[placeName];
    if (!placeData) return;
    
    const modalHTML = `
        <div class="image-modal show" id="edit-place-modal">
            <div class="image-modal-content" style="max-width: 600px; max-height: 90vh; overflow-y: auto;">
                <button class="close-image-btn" onclick="hideEditPlaceModal()">
                    <i class="fas fa-times"></i>
                </button>
                <div style="padding: 2rem;">
                    <h2 style="font-family: 'Playfair Display', serif; margin-bottom: 1.5rem; text-align: center;">
                        –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –º–µ—Å—Ç–æ
                    </h2>
                    
                    <div style="display: grid; gap: 1.5rem;">
                        <div>
                            <label style="display: block; margin-bottom: 0.5rem; color: var(--text-primary); font-weight: 500;">
                                –ù–∞–∑–≤–∞–Ω–∏–µ –º–µ—Å—Ç–∞ *
                            </label>
                            <input type="text" id="edit-place-name" 
                                   style="width: 100%; padding: 1rem; background: rgba(255,255,255,0.05); border: 1px solid var(--border); border-radius: 8px; color: var(--text-primary);"
                                   value="${placeName}">
                        </div>
                        
                        <div>
                            <label style="display: block; margin-bottom: 0.5rem; color: var(--text-primary); font-weight: 500;">
                                –ö–∞—Ç–µ–≥–æ—Ä–∏—è *
                            </label>
                            <select id="edit-place-category" 
                                    style="width: 100%; padding: 1rem; background: rgba(255,255,255,0.05); border: 1px solid var(--border); border-radius: 8px; color: var(--text-primary);">
                                <option value="coffee" ${placeData.category === 'coffee' ? 'selected' : ''}>–ö–æ—Ñ–µ–π–Ω—è</option>
                                <option value="restaurant" ${placeData.category === 'restaurant' ? 'selected' : ''}>–†–µ—Å—Ç–æ—Ä–∞–Ω</option>
                                <option value="cafe" ${placeData.category === 'cafe' ? 'selected' : ''}>–ö–∞—Ñ–µ</option>
                                <option value="bar" ${placeData.category === 'bar' ? 'selected' : ''}>–ë–∞—Ä</option>
                                <option value="cinema" ${placeData.category === 'cinema' ? 'selected' : ''}>–ö–∏–Ω–æ—Ç–µ–∞—Ç—Ä</option>
                                <option value="other" ${!placeData.category ? 'selected' : ''}>–î—Ä—É–≥–æ–µ</option>
                            </select>
                        </div>
                        
                        <div>
                            <label style="display: block; margin-bottom: 0.5rem; color: var(--text-primary); font-weight: 500;">
                                –û–ø–∏—Å–∞–Ω–∏–µ *
                            </label>
                            <textarea id="edit-place-description" rows="3"
                                      style="width: 100%; padding: 1rem; background: rgba(255,255,255,0.05); border: 1px solid var(--border); border-radius: 8px; color: var(--text-primary); resize: vertical;"
                                      placeholder="–ö—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –∑–∞–≤–µ–¥–µ–Ω–∏—è">${placeData.description}</textarea>
                        </div>
                        
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                            <div>
                                <label style="display: block; margin-bottom: 0.5rem; color: var(--text-primary); font-weight: 500;">
                                    –¢–µ–ª–µ—Ñ–æ–Ω
                                </label>
                                <input type="text" id="edit-place-phone"
                                       style="width: 100%; padding: 1rem; background: rgba(255,255,255,0.05); border: 1px solid var(--border); border-radius: 8px; color: var(--text-primary);"
                                       value="${placeData.phone || ''}">
                            </div>
                            <div>
                                <label style="display: block; margin-bottom: 0.5rem; color: var(--text-primary); font-weight: 500;">
                                    –¶–µ–Ω–æ–≤–æ–π –¥–∏–∞–ø–∞–∑–æ–Ω
                                </label>
                                <select id="edit-place-price"
                                        style="width: 100%; padding: 1rem; background: rgba(255,255,255,0.05); border: 1px solid var(--border); border-radius: 8px; color: var(--text-primary);">
                                    <option value="$" ${placeData.price === '$' ? 'selected' : ''}>$ - –ë—é–¥–∂–µ—Ç–Ω—ã–π</option>
                                    <option value="$$" ${placeData.price === '$$' ? 'selected' : ''}>$$ - –°—Ä–µ–¥–Ω–∏–π</option>
                                    <option value="$$$" ${placeData.price === '$$$' ? 'selected' : ''}>$$$ - –ü—Ä–µ–º–∏—É–º</option>
                                </select>
                            </div>
                        </div>
                        
                        <div>
                            <label style="display: block; margin-bottom: 0.5rem; color: var(--text-primary); font-weight: 500;">
                                –í—Ä–µ–º—è —Ä–∞–±–æ—Ç—ã
                            </label>
                            <input type="text" id="edit-place-hours"
                                   style="width: 100%; padding: 1rem; background: rgba(255,255,255,0.05); border: 1px solid var(--border); border-radius: 8px; color: var(--text-primary);"
                                   value="${placeData.workingHours || ''}">
                        </div>
                        
                        <div>
                            <label style="display: block; margin-bottom: 0.5rem; color: var(--text-primary); font-weight: 500;">
                                –ê–¥—Ä–µ—Å *
                            </label>
                            <input type="text" id="edit-place-address"
                                   style="width: 100%; padding: 1rem; background: rgba(255,255,255,0.05); border: 1px solid var(--border); border-radius: 8px; color: var(--text-primary);"
                                   value="${placeData.address}">
                        </div>
                        
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                            <div>
                                <label style="display: block; margin-bottom: 0.5rem; color: var(--text-primary); font-weight: 500;">
                                    –®–∏—Ä–æ—Ç–∞
                                </label>
                                <input type="number" step="any" id="edit-place-lat"
                                       style="width: 100%; padding: 1rem; background: rgba(255,255,255,0.05); border: 1px solid var(--border); border-radius: 8px; color: var(--text-primary);"
                                       value="${placeData.coords[0]}">
                            </div>
                            <div>
                                <label style="display: block; margin-bottom: 0.5rem; color: var(--text-primary); font-weight: 500;">
                                    –î–æ–ª–≥–æ—Ç–∞
                                </label>
                                <input type="number" step="any" id="edit-place-lng"
                                       style="width: 100%; padding: 1rem; background: rgba(255,255,255,0.05); border: 1px solid var(--border); border-radius: 8px; color: var(--text-primary);"
                                       value="${placeData.coords[1]}">
                            </div>
                        </div>
                        
                        <div>
                            <label style="display: block; margin-bottom: 0.5rem; color: var(--text-primary); font-weight: 500;">
                                –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ (—á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é)
                            </label>
                            <input type="text" id="edit-place-features"
                                   style="width: 100%; padding: 1rem; background: rgba(255,255,255,0.05); border: 1px solid var(--border); border-radius: 8px; color: var(--text-primary);"
                                   value="${placeData.features ? placeData.features.join(', ') : ''}">
                        </div>
                        
                        <div>
                            <label style="display: block; margin-bottom: 0.5rem; color: var(--text-primary); font-weight: 500;">
                                –°—Å—ã–ª–∫–∞ –Ω–∞ —Å–æ—Ü. —Å–µ—Ç—å –∏–ª–∏ —Å–∞–π—Ç
                            </label>
                            <input type="text" id="edit-place-social"
                                   style="width: 100%; padding: 1rem; background: rgba(255,255,255,0.05); border: 1px solid var(--border); border-radius: 8px; color: var(--text-primary);"
                                   value="${placeData.social || ''}">
                        </div>
                        
                        <div>
                            <label style="display: block; margin-bottom: 0.5rem; color: var(--text-primary); font-weight: 500;">
                                –†–µ–π—Ç–∏–Ω–≥
                            </label>
                            <input type="number" step="0.1" min="0" max="5" id="edit-place-rating"
                                   style="width: 100%; padding: 1rem; background: rgba(255,255,255,0.05); border: 1px solid var(--border); border-radius: 8px; color: var(--text-primary);"
                                   value="${placeData.rating || 0}">
                        </div>
                        
                        <div>
                            <label style="display: block; margin-bottom: 0.5rem; color: var(--text-primary); font-weight: 500;">
                                –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ—Ç–∑—ã–≤–æ–≤
                            </label>
                            <input type="number" id="edit-place-reviews"
                                   style="width: 100%; padding: 1rem; background: rgba(255,255,255,0.05); border: 1px solid var(--border); border-radius: 8px; color: var(--text-primary);"
                                   value="${placeData.reviewsCount || 0}">
                        </div>
                    </div>
                    
                    <div style="display: flex; gap: 1rem; margin-top: 2rem;">
                        <button onclick="hideEditPlaceModal()" 
                                style="flex: 1; padding: 1rem; background: rgba(255,255,255,0.05); border: 1px solid var(--border); color: var(--text-primary); border-radius: 8px; cursor: pointer;">
                            –û—Ç–º–µ–Ω–∞
                        </button>
                        <button onclick="updatePlace('${placeName}')" 
                                style="flex: 1; padding: 1rem; background: var(--warning); border: none; color: white; border-radius: 8px; cursor: pointer; font-weight: 600;">
                            <i class="fas fa-save"></i> –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è
                        </button>
                    </div>
                </div>
            </div>
        </div>
    `;
    
    const modalContainer = document.createElement('div');
    modalContainer.innerHTML = modalHTML;
    document.body.appendChild(modalContainer);
    document.body.style.overflow = 'hidden';
}

function hideEditPlaceModal() {
    const modal = document.getElementById('edit-place-modal');
    if (modal) {
        modal.remove();
    }
    document.body.style.overflow = 'auto';
}

async function updatePlace(oldPlaceName) {
    const name = document.getElementById('edit-place-name').value.trim();
    const category = document.getElementById('edit-place-category').value;
    const description = document.getElementById('edit-place-description').value.trim();
    const phone = document.getElementById('edit-place-phone').value.trim();
    const price = document.getElementById('edit-place-price').value;
    const hours = document.getElementById('edit-place-hours').value.trim();
    const address = document.getElementById('edit-place-address').value.trim();
    const lat = parseFloat(document.getElementById('edit-place-lat').value);
    const lng = parseFloat(document.getElementById('edit-place-lng').value);
    const features = document.getElementById('edit-place-features').value.split(',').map(f => f.trim()).filter(f => f);
    const social = document.getElementById('edit-place-social').value.trim();
    const rating = parseFloat(document.getElementById('edit-place-rating').value);
    const reviewsCount = parseInt(document.getElementById('edit-place-reviews').value);
    
    // –í–∞–ª–∏–¥–∞—Ü–∏—è
    if (!name || !description || !address) {
        showNotification('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è (–Ω–∞–∑–≤–∞–Ω–∏–µ, –æ–ø–∏—Å–∞–Ω–∏–µ, –∞–¥—Ä–µ—Å)', 'error');
        return;
    }
    
    if (isNaN(lat) || isNaN(lng)) {
        showNotification('–í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã', 'error');
        return;
    }
    
    try {
        // –ù–∞—Ö–æ–¥–∏–º ID –º–µ—Å—Ç–∞ –≤ Firebase
        const customPlacesRef = window.db.ref('customPlaces');
        const snapshot = await customPlacesRef.once('value');
        const customPlaces = snapshot.val();
        
        let placeId = null;
        Object.entries(customPlaces || {}).forEach(([id, place]) => {
            if (place.name === oldPlaceName) {
                placeId = id;
            }
        });
        
        if (!placeId) {
            showNotification('–ù–µ —É–¥–∞–ª–æ—Å—å –Ω–∞–π—Ç–∏ –º–µ—Å—Ç–æ –¥–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è', 'error');
            return;
        }
        
        // –û–±–Ω–æ–≤–ª—è–µ–º –æ–±—ä–µ–∫—Ç –º–µ—Å—Ç–∞
        const updatedPlace = {
            name: name,
            category: category,
            description: description,
            phone: phone || '–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è —É—Ç–æ—á–Ω—è–µ—Ç—Å—è',
            price: price,
            workingHours: hours || '–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è —É—Ç–æ—á–Ω—è–µ—Ç—Å—è',
            address: address,
            coords: [lat, lng],
            features: features,
            social: social,
            rating: rating,
            reviewsCount: reviewsCount,
            isCustom: true
        };
        
        // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ Firebase
        await savePlaceToFirebase(placeId, updatedPlace);
        
        // –û–±–Ω–æ–≤–ª—è–µ–º –ª–æ–∫–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
        delete placesData[oldPlaceName];
        placesData[name] = updatedPlace;
        
        showNotification(`–ú–µ—Å—Ç–æ "${name}" —É—Å–ø–µ—à–Ω–æ –æ–±–Ω–æ–≤–ª–µ–Ω–æ! ‚ú®`, 'success');
        hideEditPlaceModal();
        
        // –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º —Å—Ç—Ä–∞–Ω–∏—Ü—É
        setTimeout(() => {
            location.reload();
        }, 1500);
        
    } catch (error) {
        console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –º–µ—Å—Ç–∞:', error);
        showNotification('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –º–µ—Å—Ç–∞', 'error');
    }
}

// –£–¥–∞–ª–µ–Ω–∏–µ –º–µ—Å—Ç–∞
async function deletePlace(placeName) {
    if (!confirm(`–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å "${placeName}"? –≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–ª—å–∑—è –æ—Ç–º–µ–Ω–∏—Ç—å.`)) {
        return;
    }
    
    try {
        // –ù–∞—Ö–æ–¥–∏–º ID –º–µ—Å—Ç–∞ –≤ Firebase
        const customPlacesRef = window.db.ref('customPlaces');
        const snapshot = await customPlacesRef.once('value');
        const customPlaces = snapshot.val();
        
        let placeId = null;
        Object.entries(customPlaces || {}).forEach(([id, place]) => {
            if (place.name === placeName) {
                placeId = id;
            }
        });
        
        if (!placeId) {
            showNotification('–ù–µ —É–¥–∞–ª–æ—Å—å –Ω–∞–π—Ç–∏ –º–µ—Å—Ç–æ –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è', 'error');
            return;
        }
        
        // –£–¥–∞–ª—è–µ–º –∏–∑ Firebase
        await window.db.ref('customPlaces/' + placeId).remove();
        await window.db.ref('customPlaceImages/' + placeId).remove();
        
        // –£–¥–∞–ª—è–µ–º –∏–∑ –ª–æ–∫–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
        delete placesData[placeName];
        delete placeImages[placeName];
        
        showNotification(`–ú–µ—Å—Ç–æ "${placeName}" —É—Å–ø–µ—à–Ω–æ —É–¥–∞–ª–µ–Ω–æ! üóëÔ∏è`, 'success');
        
        // –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º —Å—Ç—Ä–∞–Ω–∏—Ü—É
        setTimeout(() => {
            location.reload();
        }, 1500);
        
    } catch (error) {
        console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ –º–µ—Å—Ç–∞:', error);
        showNotification('–û—à–∏–±–∫–∞ –ø—Ä–∏ —É–¥–∞–ª–µ–Ω–∏–∏ –º–µ—Å—Ç–∞', 'error');
    }
}

// –ü–æ–∫–∞–∑–∞—Ç—å –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –º–µ—Å—Ç–∞
function showAddPlaceModal() {
    const modalHTML = `
        <div class="image-modal show" id="add-place-modal">
            <div class="image-modal-content" style="max-width: 600px; max-height: 90vh; overflow-y: auto;">
                <button class="close-image-btn" onclick="hideAddPlaceModal()">
                    <i class="fas fa-times"></i>
                </button>
                <div style="padding: 2rem;">
                    <h2 style="font-family: 'Playfair Display', serif; margin-bottom: 1.5rem; text-align: center;">
                        –î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤–æ–µ –º–µ—Å—Ç–æ
                    </h2>
                    
                    <div style="display: grid; gap: 1.5rem;">
                        <div>
                            <label style="display: block; margin-bottom: 0.5rem; color: var(--text-primary); font-weight: 500;">
                                –ù–∞–∑–≤–∞–Ω–∏–µ –º–µ—Å—Ç–∞ *
                            </label>
                            <input type="text" id="new-place-name" 
                                   style="width: 100%; padding: 1rem; background: rgba(255,255,255,0.05); border: 1px solid var(--border); border-radius: 8px; color: var(--text-primary);"
                                   placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –ö–æ—Ñ–µ–π–Ω—è ¬´–ù–∞–∑–≤–∞–Ω–∏–µ¬ª">
                        </div>
                        
                        <div>
                            <label style="display: block; margin-bottom: 0.5rem; color: var(--text-primary); font-weight: 500;">
                                –ö–∞—Ç–µ–≥–æ—Ä–∏—è *
                            </label>
                            <select id="new-place-category" 
                                    style="width: 100%; padding: 1rem; background: rgba(255,255,255,0.05); border: 1px solid var(--border); border-radius: 8px; color: var(--text-primary);">
                                <option value="coffee">–ö–æ—Ñ–µ–π–Ω—è</option>
                                <option value="restaurant">–†–µ—Å—Ç–æ—Ä–∞–Ω</option>
                                <option value="cafe">–ö–∞—Ñ–µ</option>
                                <option value="bar">–ë–∞—Ä/–ì–∞—Å—Ç—Ä–æ–ø–∞–±</option>
                                <option value="cinema">–ö–∏–Ω–æ—Ç–µ–∞—Ç—Ä</option>
                                <option value="other">–î—Ä—É–≥–æ–µ</option>
                            </select>
                        </div>
                        
                        <div>
                            <label style="display: block; margin-bottom: 0.5rem; color: var(--text-primary); font-weight: 500;">
                                –û–ø–∏—Å–∞–Ω–∏–µ *
                            </label>
                            <textarea id="new-place-description" rows="3"
                                      style="width: 100%; padding: 1rem; background: rgba(255,255,255,0.05); border: 1px solid var(--border); border-radius: 8px; color: var(--text-primary); resize: vertical;"
                                      placeholder="–ö—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –∑–∞–≤–µ–¥–µ–Ω–∏—è"></textarea>
                        </div>
                        
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                            <div>
                                <label style="display: block; margin-bottom: 0.5rem; color: var(--text-primary); font-weight: 500;">
                                    –¢–µ–ª–µ—Ñ–æ–Ω
                                </label>
                                <input type="text" id="new-place-phone"
                                       style="width: 100%; padding: 1rem; background: rgba(255,255,255,0.05); border: 1px solid var(--border); border-radius: 8px; color: var(--text-primary);"
                                       placeholder="+7 (XXX) XXX-XX-XX">
                            </div>
                            <div>
                                <label style="display: block; margin-bottom: 0.5rem; color: var(--text-primary); font-weight: 500;">
                                    –¶–µ–Ω–æ–≤–æ–π –¥–∏–∞–ø–∞–∑–æ–Ω
                                </label>
                                <select id="new-place-price"
                                        style="width: 100%; padding: 1rem; background: rgba(255,255,255,0.05); border: 1px solid var(--border); border-radius: 8px; color: var(--text-primary);">
                                    <option value="$">$ - –ë—é–¥–∂–µ—Ç–Ω—ã–π</option>
                                    <option value="$$" selected>$$ - –°—Ä–µ–¥–Ω–∏–π</option>
                                    <option value="$$$">$$$ - –ü—Ä–µ–º–∏—É–º</option>
                                </select>
                            </div>
                        </div>
                        
                        <div>
                            <label style="display: block; margin-bottom: 0.5rem; color: var(--text-primary); font-weight: 500;">
                                –í—Ä–µ–º—è —Ä–∞–±–æ—Ç—ã
                            </label>
                            <input type="text" id="new-place-hours"
                                   style="width: 100%; padding: 1rem; background: rgba(255,255,255,0.05); border: 1px solid var(--border); border-radius: 8px; color: var(--text-primary);"
                                   placeholder="–ü–Ω-–ü—Ç: 10:00-22:00, –°–±-–í—Å: 11:00-23:00">
                        </div>
                        
                        <div>
                            <label style="display: block; margin-bottom: 0.5rem; color: var(--text-primary); font-weight: 500;">
                                –ê–¥—Ä–µ—Å *
                            </label>
                            <input type="text" id="new-place-address"
                                   style="width: 100%; padding: 1rem; background: rgba(255,255,255,0.05); border: 1px solid var(--border); border-radius: 8px; color: var(--text-primary);"
                                   placeholder="–£–ª–∏—Ü–∞, –¥–æ–º">
                        </div>
                        
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                            <div>
                                <label style="display: block; margin-bottom: 0.5rem; color: var(--text-primary); font-weight: 500;">
                                    –®–∏—Ä–æ—Ç–∞
                                </label>
                                <input type="number" step="any" id="new-place-lat"
                                       style="width: 100%; padding: 1rem; background: rgba(255,255,255,0.05); border: 1px solid var(--border); border-radius: 8px; color: var(--text-primary);"
                                       placeholder="59.880945" value="59.880945">
                            </div>
                            <div>
                                <label style="display: block; margin-bottom: 0.5rem; color: var(--text-primary); font-weight: 500;">
                                    –î–æ–ª–≥–æ—Ç–∞
                                </label>
                                <input type="number" step="any" id="new-place-lng"
                                       style="width: 100%; padding: 1rem; background: rgba(255,255,255,0.05); border: 1px solid var(--border); border-radius: 8px; color: var(--text-primary);"
                                       placeholder="29.112260" value="29.112260">
                            </div>
                        </div>
                        
                        <div>
                            <label style="display: block; margin-bottom: 0.5rem; color: var(--text-primary); font-weight: 500;">
                                –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ (—á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é)
                            </label>
                            <input type="text" id="new-place-features"
                                   style="width: 100%; padding: 1rem; background: rgba(255,255,255,0.05); border: 1px solid var(--border); border-radius: 8px; color: var(--text-primary);"
                                   placeholder="Wi-Fi, –ü–∞—Ä–∫–æ–≤–∫–∞, –¢–µ—Ä—Ä–∞—Å–∞">
                        </div>
                        
                        <div>
                            <label style="display: block; margin-bottom: 0.5rem; color: var(--text-primary); font-weight: 500;">
                                –°—Å—ã–ª–∫–∞ –Ω–∞ —Å–æ—Ü. —Å–µ—Ç—å –∏–ª–∏ —Å–∞–π—Ç
                            </label>
                            <input type="text" id="new-place-social"
                                   style="width: 100%; padding: 1rem; background: rgba(255,255,255,0.05); border: 1px solid var(--border); border-radius: 8px; color: var(--text-primary);"
                                   placeholder="vk.com/username –∏–ª–∏ site.ru">
                        </div>
                        
                        <div>
                            <label style="display: block; margin-bottom: 0.5rem; color: var(--text-primary); font-weight: 500;">
                                –°—Å—ã–ª–∫–∏ –Ω–∞ —Ñ–æ—Ç–æ (–∫–∞–∂–¥–∞—è —Å –Ω–æ–≤–æ–π —Å—Ç—Ä–æ–∫–∏)
                            </label>
                            <textarea id="new-place-images" rows="3"
                                      style="width: 100%; padding: 1rem; background: rgba(255,255,255,0.05); border: 1px solid var(--border); border-radius: 8px; color: var(--text-primary); resize: vertical;"
                                      placeholder="https://example.com/photo1.jpg\nhttps://example.com/photo2.jpg"></textarea>
                        </div>
                    </div>
                    
                    <div style="display: flex; gap: 1rem; margin-top: 2rem;">
                        <button onclick="hideAddPlaceModal()" 
                                style="flex: 1; padding: 1rem; background: rgba(255,255,255,0.05); border: 1px solid var(--border); color: var(--text-primary); border-radius: 8px; cursor: pointer;">
                            –û—Ç–º–µ–Ω–∞
                        </button>
                        <button onclick="addNewPlace()" 
                                style="flex: 1; padding: 1rem; background: var(--success); border: none; color: white; border-radius: 8px; cursor: pointer; font-weight: 600;">
                            <i class="fas fa-plus"></i> –î–æ–±–∞–≤–∏—Ç—å –º–µ—Å—Ç–æ
                        </button>
                    </div>
                </div>
            </div>
        </div>
    `;
    
    const modalContainer = document.createElement('div');
    modalContainer.innerHTML = modalHTML;
    document.body.appendChild(modalContainer);
    document.body.style.overflow = 'hidden';
    
    // –§–æ–∫—É—Å –Ω–∞ –ø–µ—Ä–≤–æ–º –ø–æ–ª–µ
    setTimeout(() => {
        document.getElementById('new-place-name').focus();
    }, 100);
}

// –°–∫—Ä—ã—Ç—å –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –º–µ—Å—Ç–∞
function hideAddPlaceModal() {
    const modal = document.getElementById('add-place-modal');
    if (modal) {
        modal.remove();
    }
    document.body.style.overflow = 'auto';
}

// –î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤–æ–µ –º–µ—Å—Ç–æ
async function addNewPlace() {
    const name = document.getElementById('new-place-name').value.trim();
    const category = document.getElementById('new-place-category').value;
    const description = document.getElementById('new-place-description').value.trim();
    const phone = document.getElementById('new-place-phone').value.trim();
    const price = document.getElementById('new-place-price').value;
    const hours = document.getElementById('new-place-hours').value.trim();
    const address = document.getElementById('new-place-address').value.trim();
    const lat = parseFloat(document.getElementById('new-place-lat').value);
    const lng = parseFloat(document.getElementById('new-place-lng').value);
    const features = document.getElementById('new-place-features').value.split(',').map(f => f.trim()).filter(f => f);
    const social = document.getElementById('new-place-social').value.trim();
    const images = document.getElementById('new-place-images').value.split('\n').map(url => url.trim()).filter(url => url);
    
    // –í–∞–ª–∏–¥–∞—Ü–∏—è
    if (!name || !description || !address) {
        showNotification('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è (–Ω–∞–∑–≤–∞–Ω–∏–µ, –æ–ø–∏—Å–∞–Ω–∏–µ, –∞–¥—Ä–µ—Å)', 'error');
        return;
    }
    
    if (isNaN(lat) || isNaN(lng)) {
        showNotification('–í–≤–µ–¥–∏—Ç–µ –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã', 'error');
        return;
    }
    
    try {
        // –°–æ–∑–¥–∞–µ–º –æ–±—ä–µ–∫—Ç –º–µ—Å—Ç–∞
        const newPlace = {
            name: name,
            category: category,
            description: description,
            phone: phone || '–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è —É—Ç–æ—á–Ω—è–µ—Ç—Å—è',
            price: price,
            workingHours: hours || '–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è —É—Ç–æ—á–Ω—è–µ—Ç—Å—è',
            address: address,
            coords: [lat, lng],
            features: features,
            social: social,
            rating: 0,
            reviewsCount: 0,
            isCustom: true // –ü–æ–º–µ—á–∞–µ–º –∫–∞–∫ –∫–∞—Å—Ç–æ–º–Ω–æ–µ
        };
        
        // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ Firebase
        const placeId = 'custom_' + Date.now();
        await savePlaceToFirebase(placeId, newPlace);
        
        // –°–æ—Ö—Ä–∞–Ω—è–µ–º –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –µ—Å–ª–∏ –µ—Å—Ç—å
        if (images.length > 0) {
            await savePlaceImagesToFirebase(placeId, images);
        }
        
        showNotification(`–ú–µ—Å—Ç–æ "${name}" —É—Å–ø–µ—à–Ω–æ –¥–æ–±–∞–≤–ª–µ–Ω–æ! üéâ`, 'success');
        hideAddPlaceModal();
        
        // –ü–µ—Ä–µ–∑–∞–≥—Ä—É–∂–∞–µ–º —Å—Ç—Ä–∞–Ω–∏—Ü—É —á—Ç–æ–±—ã –ø–æ–∫–∞–∑–∞—Ç—å –Ω–æ–≤–æ–µ –º–µ—Å—Ç–æ
        setTimeout(() => {
            location.reload();
        }, 2000);
        
    } catch (error) {
        console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –º–µ—Å—Ç–∞:', error);
        showNotification('–û—à–∏–±–∫–∞ –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –º–µ—Å—Ç–∞', 'error');
    }
}

// –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –º–µ—Å—Ç–æ –≤ Firebase
function savePlaceToFirebase(placeId, placeData) {
    return new Promise((resolve, reject) => {
        const updates = {};
        updates['customPlaces/' + placeId] = placeData;
        
        window.db.ref().update(updates)
            .then(() => resolve(true))
            .catch(error => reject(error));
    });
}

// –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –º–µ—Å—Ç–∞ –≤ Firebase
function savePlaceImagesToFirebase(placeId, images) {
    return new Promise((resolve, reject) => {
        const updates = {};
        updates['customPlaceImages/' + placeId] = images;
        
        window.db.ref().update(updates)
            .then(() => resolve(true))
            .catch(error => reject(error));
    });
}

// –ó–∞–≥—Ä—É–∑–∫–∞ –∫–∞—Å—Ç–æ–º–Ω—ã—Ö –º–µ—Å—Ç –∏–∑ Firebase
function loadCustomPlaces() {
    return new Promise((resolve) => {
        const customPlacesRef = window.db.ref('customPlaces');
        customPlacesRef.once('value')
            .then(snapshot => {
                const data = snapshot.val();
                if (data) {
                    // –î–æ–±–∞–≤–ª—è–µ–º –∫–∞—Å—Ç–æ–º–Ω—ã–µ –º–µ—Å—Ç–∞ –≤ –æ–±—â–∏–π —Å–ø–∏—Å–æ–∫
                    Object.entries(data).forEach(([id, place]) => {
                        placesData[place.name] = {
                            ...place,
                            isCustom: true
                        };
                    });
                    console.log('‚úÖ –ó–∞–≥—Ä—É–∂–µ–Ω—ã –∫–∞—Å—Ç–æ–º–Ω—ã–µ –º–µ—Å—Ç–∞:', data);
                }
                resolve();
            })
            .catch(error => {
                console.error('‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∫–∞—Å—Ç–æ–º–Ω—ã—Ö –º–µ—Å—Ç:', error);
                resolve();
            });
    });
}

// –ó–∞–≥—Ä—É–∑–∫–∞ –∫–∞—Å—Ç–æ–º–Ω—ã—Ö –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π –∏–∑ Firebase
function loadCustomPlaceImages() {
    return new Promise((resolve) => {
        const customImagesRef = window.db.ref('customPlaceImages');
        customImagesRef.once('value')
            .then(snapshot => {
                const data = snapshot.val();
                if (data) {
                    Object.entries(data).forEach(([id, images]) => {
                        // –ù–∞—Ö–æ–¥–∏–º –Ω–∞–∑–≤–∞–Ω–∏–µ –º–µ—Å—Ç–∞ –ø–æ ID (–Ω—É–∂–Ω–æ —Å–æ–ø–æ—Å—Ç–∞–≤–∏—Ç—å)
                        const placeEntry = Object.entries(placesData).find(([name, place]) => 
                            place.isCustom && id.includes('custom_')
                        );
                        if (placeEntry) {
                            placeImages[placeEntry[0]] = images;
                        }
                    });
                    console.log('‚úÖ –ó–∞–≥—Ä—É–∂–µ–Ω—ã –∫–∞—Å—Ç–æ–º–Ω—ã–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è:', data);
                }
                resolve();
            })
            .catch(error => {
                console.error('‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∫–∞—Å—Ç–æ–º–Ω—ã—Ö –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π:', error);
                resolve();
            });
    });
}

// ================== –û–°–ù–û–í–ù–´–ï –§–£–ù–ö–¶–ò–ò ==================

// –ü—Ä–æ–≤–µ—Ä—è–µ–º, –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω –ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
window.addEventListener('load', () => {
    console.log('üîÑ –ó–∞–≥—Ä—É–∑–∫–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—ã...');
    const savedUser = localStorage.getItem('currentUser');
    if (savedUser) {
        const user = JSON.parse(savedUser);
        console.log('üíæ –°–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å:', user);
        showMainContent(user);
    } else {
        console.log('üëã –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω');
        accessKeyInput.focus();
    }
});

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–∫–∞–∑–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
function showNotification(message, type = 'success') {
    const existingNotification = document.querySelector('.notification');
    if (existingNotification) {
        existingNotification.remove();
    }

    const notification = document.createElement('div');
    notification.className = `notification ${type}`;
    notification.textContent = message;
    
    document.body.appendChild(notification);

    setTimeout(() => {
        notification.classList.add('show');
    }, 100);

    setTimeout(() => {
        notification.classList.remove('show');
        setTimeout(() => {
            if (notification.parentNode) {
                notification.parentNode.removeChild(notification);
            }
        }, 300);
    }, 3000);
}

// –§—É–Ω–∫—Ü–∏—è —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∏–º–µ–Ω–∏ –¥–ª—è –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏—è
function formatDisplayName(user) {
    // –°–ø–µ—Ü–∏–∞–ª—å–Ω–æ–µ –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ –¥–ª—è –ù–∞–¥—å—è—Ä–Ω–æ–π –ï–ª–∏–∑–∞–≤–µ—Ç—ã
    if (user.key === 'E9L0I1Z2') {
        return '–°–ø—è—â–∞—è –ö—Ä–∞—Å–∞–≤–∏—Ü–∞';
    } else if (user.role === '–£—á–∏—Ç–µ–ª—å') {
        return '–õ–∞—Ä–∏—Å–∞ –ö.';
    } else if (user.role === '–í–ª–∞–¥–µ–ª–µ—Ü —Å–∞–π—Ç–∞') {
        return '–ë–∞–≥—Ä–∞—Ç';
    } else {
        const nameParts = user.name.split(' ');
        const lastName = nameParts[0];
        const firstNameInitial = nameParts[1] ? nameParts[1].charAt(0) + '.' : '';
        return `${lastName} ${firstNameInitial}`;
    }
}

// –§—É–Ω–∫—Ü–∏—è –ø–æ–∫–∞–∑–∞ –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –∫–æ–Ω—Ç–µ–Ω—Ç–∞
function showMainContent(user) {
    console.log('üîë –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–æ—à–µ–ª:', user);
    
    const displayName = formatDisplayName(user);
    welcomeName.textContent = displayName;
    
    // –°–æ—Ö—Ä–∞–Ω—è–µ–º –∫–ª—é—á –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    if (users[user.key]) {
        currentUserKey = user.key;
        console.log('‚úÖ currentUserKey —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –∏–∑ user.key:', currentUserKey);
    } else {
        // –ù–∞—Ö–æ–¥–∏–º –∫–ª—é—á –ø–æ –∏–º–µ–Ω–∏ (fallback)
        const userEntry = Object.entries(users).find(([key, u]) => u.name === user.name && u.role === user.role);
        if (userEntry) {
            currentUserKey = userEntry[0];
            user.key = currentUserKey; // —Å–æ—Ö—Ä–∞–Ω—è–µ–º –∫–ª—é—á –≤ –æ–±—ä–µ–∫—Ç–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
            console.log('üîç currentUserKey –Ω–∞–π–¥–µ–Ω –ø–æ –∏–º–µ–Ω–∏:', currentUserKey);
        } else {
            console.warn('‚ö†Ô∏è –ù–µ —É–¥–∞–ª–æ—Å—å –Ω–∞–π—Ç–∏ –∫–ª—é—á –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è');
        }
    }
    
    console.log('üîê –¢–µ–∫—É—â–∏–π –∫–ª—é—á –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:', currentUserKey);
    console.log('üë§ –î–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:', users[currentUserKey]);
    
    loginScreen.style.display = 'none';
    mainContent.style.display = 'block';
    
    // –°–ø–µ—Ü–∏–∞–ª—å–Ω—ã–µ –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏—è
    if (user.key === 'E9L0I1Z2') {
        showNotification('–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å, –°–ø—è—â–∞—è –ö—Ä–∞—Å–∞–≤–∏—Ü–∞! üí´ –ü—Ä–æ—Å–Ω–∏—Å—å –∏ –≥–æ–ª–æ—Å—É–π –∑–∞ –ª—é–±–∏–º—ã–µ –º–µ—Å—Ç–∞!');
    } else if (user.role === '–í–ª–∞–¥–µ–ª–µ—Ü —Å–∞–π—Ç–∞') {
        showNotification('–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å, —Å–æ–∑–¥–∞—Ç–µ–ª—å! üéâ –í–∞—à —Å–∞–π—Ç –≤—ã–≥–ª—è–¥–∏—Ç –ø—Ä–µ–º–∏–∞–ª—å–Ω–æ!');
    } else if (user.role === '–£—á–∏—Ç–µ–ª—å') {
        showNotification('–ó–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ, –õ–∞—Ä–∏—Å–∞ –ö–∞–¥—ã—Ä–æ–≤–Ω–∞! üë©‚Äçüè´ –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å!');
    } else {
        showNotification(`–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å, ${displayName}! ‚ú® –¢–µ–ø–µ—Ä—å –≤—ã –º–æ–∂–µ—Ç–µ –≥–æ–ª–æ—Å–æ–≤–∞—Ç—å –∑–∞ –ª—é–±–∏–º—ã–µ –º–µ—Å—Ç–∞`);
    }

    window.scrollTo({ top: 0, behavior: 'smooth' });
    setTimeout(initCardAnimations, 500);
    
    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º —Å–∏—Å—Ç–µ–º—É –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏—è
    setTimeout(() => {
        initVotingSystem();
        updateVoteButtons();
        setupVotesSearch();
    }, 1000);
    
    // –ó–∞–≥—Ä—É–∂–∞–µ–º –∫–∞—Å—Ç–æ–º–Ω—ã–µ –º–µ—Å—Ç–∞ –∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
    setTimeout(async () => {
        await loadCustomPlaces();
        await loadCustomPlaceImages();
        
        // –ü–µ—Ä–µ—Ä–∏—Å–æ–≤—ã–≤–∞–µ–º –∫–∞—Ä—Ç–æ—á–∫–∏ –µ—Å–ª–∏ –Ω—É–∂–Ω–æ
        if (Object.keys(placesData).length > 7) { // –ï—Å–ª–∏ –µ—Å—Ç—å –∫–∞—Å—Ç–æ–º–Ω—ã–µ –º–µ—Å—Ç–∞
            // –ú–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å –ª–æ–≥–∏–∫—É –¥–ª—è –ø–µ—Ä–µ—Ä–∏—Å–æ–≤–∫–∏ –∫–∞—Ä—Ç–æ—á–µ–∫
            console.log('üîÑ –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å —Å —É—á–µ—Ç–æ–º –∫–∞—Å—Ç–æ–º–Ω—ã—Ö –º–µ—Å—Ç');
        }
        
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–∞—Ä—Ç–æ—á–∫–∞–º–∏ –¥–ª—è –≤–ª–∞–¥–µ–ª—å—Ü–∞
        initCardManagement();
    }, 1500);
}

// –§—É–Ω–∫—Ü–∏—è –≤—Ö–æ–¥–∞
function login() {
    const key = accessKeyInput.value.trim().toUpperCase();
    
    if (!key) {
        showNotification('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ –∫–ª—é—á –¥–æ—Å—Ç—É–ø–∞', 'error');
        return;
    }

    loginBtn.classList.add('loading');
    
    setTimeout(() => {
        const user = users[key];
        
        if (user) {
            userAvatar.textContent = user.avatar;
            userName.textContent = user.name;
            userRole.textContent = user.role;
            userInfo.classList.add('show');
            
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º –∫–ª—é—á –≤ –æ–±—ä–µ–∫—Ç–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
            user.key = key;
            
            setTimeout(() => {
                localStorage.setItem('currentUser', JSON.stringify(user));
                showMainContent(user);
            }, 800);
            
        } else {
            showNotification('–ù–µ–≤–µ—Ä–Ω—ã–π –∫–ª—é—á –¥–æ—Å—Ç—É–ø–∞', 'error');
            accessKeyInput.style.animation = 'shake 0.5s';
            setTimeout(() => {
                accessKeyInput.style.animation = '';
            }, 500);
        }
        
        loginBtn.classList.remove('loading');
    }, 1200);
}

// –§—É–Ω–∫—Ü–∏—è –≤—ã—Ö–æ–¥–∞
function logout() {
    localStorage.removeItem('currentUser');
    accessKeyInput.value = '';
    userInfo.classList.remove('show');
    mainContent.style.display = 'none';
    loginScreen.style.display = 'flex';
    accessKeyInput.focus();
    showNotification('–í—ã –≤—ã—à–ª–∏ –∏–∑ —Å–∏—Å—Ç–µ–º—ã. –í–æ–∑–≤—Ä–∞—â–∞–π—Ç–µ—Å—å —Å–∫–æ—Ä–µ–µ! üëã');
}

// –§—É–Ω–∫—Ü–∏—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –∫–∞—Ä—Ç—ã
function initMap(placeName) {
    const place = placesData[placeName];
    if (!place) return;

    currentPlace = place;

    // –û—á–∏—â–∞–µ–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –∫–∞—Ä—Ç—ã
    mapContainer.innerHTML = '';
    
    // –°–æ–∑–¥–∞–µ–º –∫–∞—Ä—Ç—É
    ymap = new ymaps.Map(mapContainer, {
        center: place.coords,
        zoom: 16,
        controls: ['zoomControl', 'fullscreenControl']
    }, {
        searchControlProvider: 'yandex#search'
    });

    // –°–æ–∑–¥–∞–µ–º —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –±–∞–ª—É–Ω–∞
    const balloonContent = `
        <div style="padding: 15px; max-width: 300px; font-family: Arial, sans-serif;">
            <h3 style="margin: 0 0 10px 0; color: #333; font-size: 18px;">${placeName}</h3>
            <p style="margin: 0 0 8px 0; color: #666; font-size: 14px;">${place.description}</p>
            <div style="margin: 8px 0;">
                <strong style="color: #333;">üìû –¢–µ–ª–µ—Ñ–æ–Ω:</strong> 
                <span style="color: #666;">${place.phone}</span>
            </div>
            <div style="margin: 8px 0;">
                <strong style="color: #333;">üïí –í—Ä–µ–º—è —Ä–∞–±–æ—Ç—ã:</strong> 
                <span style="color: #666;">${place.workingHours}</span>
            </div>
            <div style="margin: 8px 0;">
                <strong style="color: #333;">‚≠ê –†–µ–π—Ç–∏–Ω–≥:</strong> 
                <span style="color: #666;">${place.rating} (${place.reviewsCount} –æ—Ç–∑—ã–≤–æ–≤)</span>
            </div>
            <div style="margin: 8px 0;">
                <strong style="color: #333;">üìç –ê–¥—Ä–µ—Å:</strong> 
                <span style="color: #666;">${place.address}</span>
            </div>
        </div>
    `;

    // –î–æ–±–∞–≤–ª—è–µ–º –º–µ—Ç–∫—É
    const placemark = new ymaps.Placemark(place.coords, {
        balloonContent: balloonContent
    }, {
        preset: 'islands#redDotIcon',
        balloonCloseButton: true,
        hideIconOnBalloonOpen: false
    });

    ymap.geoObjects.add(placemark);
    
    // –û—Ç–∫—Ä—ã–≤–∞–µ–º –±–∞–ª—É–Ω
    placemark.balloon.open();

    // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –≤ –º–æ–¥–∞–ª—å–Ω–æ–º –æ–∫–Ω–µ
    mapPlaceTitle.textContent = placeName;
    mapAddressText.textContent = place.address;
}

// –§—É–Ω–∫—Ü–∏—è –ø–æ–∫–∞–∑–∞ –∫–∞—Ä—Ç—ã
function showMap(placeName) {
    if (!placeName || !placesData[placeName]) {
        showNotification('–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–∏ –≤—Ä–µ–º–µ–Ω–Ω–æ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞', 'error');
        return;
    }

    mapModal.classList.add('show');
    document.body.style.overflow = 'hidden';

    // –ï—Å–ª–∏ –Ø–Ω–¥–µ–∫—Å –ö–∞—Ä—Ç—ã —É–∂–µ –∑–∞–≥—Ä—É–∂–µ–Ω—ã, –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –∫–∞—Ä—Ç—É
    if (window.ymaps) {
        ymaps.ready(() => initMap(placeName));
    } else {
        // –ó–∞–≥—Ä—É–∂–∞–µ–º –Ø–Ω–¥–µ–∫—Å –ö–∞—Ä—Ç—ã
        const script = document.createElement('script');
        script.src = 'https://api-maps.yandex.ru/2.1/?lang=ru_RU';
        script.onload = () => {
            ymaps.ready(() => initMap(placeName));
        };
        document.head.appendChild(script);
    }
}

// –§—É–Ω–∫—Ü–∏—è —Å–∫—Ä—ã—Ç–∏—è –∫–∞—Ä—Ç—ã
function hideMap() {
    mapModal.classList.remove('show');
    document.body.style.overflow = 'auto';
    
    if (ymap) {
        ymap.destroy();
        ymap = null;
    }
}

// –§—É–Ω–∫—Ü–∏—è –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è –º–µ–∂–¥—É –∏–∫–æ–Ω–∫–æ–π –∏ —Ñ–æ—Ç–æ
function toggleImage(card) {
    const cardImage = card.querySelector('.card-image');
    const placeholder = cardImage.querySelector('.image-placeholder');
    const realImage = cardImage.querySelector('.real-image');
    const toggleBtn = cardImage.querySelector('.toggle-image-btn');
    
    if (realImage.classList.contains('active')) {
        // –í–æ–∑–≤—Ä–∞—â–∞–µ–º –∏–∫–æ–Ω–∫—É
        realImage.classList.remove('active');
        placeholder.classList.remove('hidden');
        toggleBtn.innerHTML = '<i class="fas fa-camera"></i> –§–æ—Ç–æ';
    } else {
        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ñ–æ—Ç–æ
        const placeName = card.querySelector('.card-title').textContent;
        const images = placeImages[placeName];
        
        if (images && images.length > 0) {
            // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø–µ—Ä–≤–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ
            realImage.style.backgroundImage = `url(${images[0]})`;
            realImage.classList.add('active');
            placeholder.classList.add('hidden');
            toggleBtn.innerHTML = '<i class="fas fa-palette"></i> –ò–∫–æ–Ω–∫–∞';
        } else {
            showNotification('–§–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏ –¥–ª—è —ç—Ç–æ–≥–æ –∑–∞–≤–µ–¥–µ–Ω–∏—è —Å–∫–æ—Ä–æ –ø–æ—è–≤—è—Ç—Å—è! üì∏', 'error');
        }
    }
}

// –§—É–Ω–∫—Ü–∏—è –ø–æ–∫–∞–∑–∞ –ø–æ–ª–Ω–æ—ç–∫—Ä–∞–Ω–Ω–æ–≥–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è —Å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å—é –ø–µ—Ä–µ–ª–∏—Å—Ç—ã–≤–∞–Ω–∏—è
function showFullscreenImage(placeName) {
    const images = placeImages[placeName];
    if (!images || images.length === 0) {
        showNotification('–§–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏ –¥–ª—è —ç—Ç–æ–≥–æ –∑–∞–≤–µ–¥–µ–Ω–∏—è —Å–∫–æ—Ä–æ –ø–æ—è–≤—è—Ç—Å—è! üì∏', 'error');
        return;
    }
    
    currentImages = images;
    currentImageIndex = 0;
    currentPlaceName = placeName;
    
    updateFullscreenImage();
    imageModal.classList.add('show');
    document.body.style.overflow = 'hidden';
}

// –§—É–Ω–∫—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ø–æ–ª–Ω–æ—ç–∫—Ä–∞–Ω–Ω–æ–≥–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
function updateFullscreenImage() {
    if (currentImages.length === 0) return;
    
    fullscreenImage.src = currentImages[currentImageIndex];
    imageModalTitle.textContent = currentPlaceName;
    
    // –û–±–Ω–æ–≤–ª—è–µ–º —Å—á–µ—Ç—á–∏–∫
    currentImageElement.textContent = currentImageIndex + 1;
    totalImagesElement.textContent = currentImages.length;
    
    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º/—Å–∫—Ä—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫–∏ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏
    prevImageBtn.classList.toggle('hidden', currentImages.length <= 1);
    nextImageBtn.classList.toggle('hidden', currentImages.length <= 1);
    
    // –°–∫—Ä—ã–≤–∞–µ–º —Å—á–µ—Ç—á–∏–∫ –µ—Å–ª–∏ —Ç–æ–ª—å–∫–æ –æ–¥–Ω–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ
    document.querySelector('.image-counter').style.display = 
        currentImages.length <= 1 ? 'none' : 'block';
}

// –§—É–Ω–∫—Ü–∏—è –ø–µ—Ä–µ—Ö–æ–¥–∞ –∫ —Å–ª–µ–¥—É—é—â–µ–º—É –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—é
function nextImage() {
    if (currentImages.length <= 1) return;
    
    currentImageIndex = (currentImageIndex + 1) % currentImages.length;
    updateFullscreenImage();
}

// –§—É–Ω–∫—Ü–∏—è –ø–µ—Ä–µ—Ö–æ–¥–∞ –∫ –ø—Ä–µ–¥—ã–¥—É—â–µ–º—É –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—é
function prevImage() {
    if (currentImages.length <= 1) return;
    
    currentImageIndex = (currentImageIndex - 1 + currentImages.length) % currentImages.length;
    updateFullscreenImage();
}

// –§—É–Ω–∫—Ü–∏—è —Å–∫—Ä—ã—Ç–∏—è –ø–æ–ª–Ω–æ—ç–∫—Ä–∞–Ω–Ω–æ–≥–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
function hideFullscreenImage() {
    imageModal.classList.remove('show');
    document.body.style.overflow = 'auto';
    fullscreenImage.src = '';
    currentImages = [];
    currentImageIndex = 0;
}

// –ê–Ω–∏–º–∞—Ü–∏–∏ –∫–∞—Ä—Ç–æ—á–µ–∫
function initCardAnimations() {
    const observerOptions = {
        threshold: 0.1,
        rootMargin: '0px 0px -50px 0px'
    };

    const observer = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
            if (entry.isIntersecting) {
                entry.target.style.opacity = '1';
                entry.target.style.transform = 'translateY(0)';
            }
        });
    }, observerOptions);

    const cards = document.querySelectorAll('.place-card');
    cards.forEach((card, index) => {
        card.style.opacity = '0';
        card.style.transform = 'translateY(30px)';
        card.style.transition = `all 0.6s cubic-bezier(0.4, 0, 0.2, 1) ${index * 0.1}s`;
        observer.observe(card);
    });
}

// –°–ò–°–¢–ï–ú–ê –ì–û–õ–û–°–û–í–ê–ù–ò–Ø

// –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∫–Ω–æ–ø–æ–∫ –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏—è
function setupVotingButtons() {
    document.addEventListener('click', (e) => {
        if (e.target.classList.contains('vote-btn') || e.target.closest('.vote-btn')) {
            const btn = e.target.classList.contains('vote-btn') ? e.target : e.target.closest('.vote-btn');
            const card = btn.closest('.place-card');
            const placeName = card.querySelector('.card-title').textContent;
            
            handleVote(placeName);
        }
        
        if (e.target.classList.contains('change-vote-btn') || e.target.closest('.change-vote-btn')) {
            showVotingModal();
        }
    });
}

// –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–Ω–æ–ø–æ–∫ –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏—è
function updateVoteButtons() {
    const voteButtons = document.querySelectorAll('.vote-btn');
    
    // –ì–ê–†–ê–ù–¢–ò–†–£–ï–ú –±–µ–∑–æ–ø–∞—Å–Ω—ã–π –¥–æ—Å—Ç—É–ø –∫ –¥–∞–Ω–Ω—ã–º
    const currentUserData = votingData[currentUserKey];
    const currentUserVotes = currentUserData && Array.isArray(currentUserData.votedFor) 
        ? currentUserData.votedFor 
        : [];
    
    console.log('üîÑ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–Ω–æ–ø–æ–∫ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:', currentUserKey, '–≥–æ–ª–æ—Å–∞:', currentUserVotes);
    
    voteButtons.forEach(btn => {
        const card = btn.closest('.place-card');
        const placeName = card.querySelector('.card-title').textContent;
        const hasVoted = currentUserVotes.includes(placeName);
        
        if (hasVoted) {
            btn.classList.add('voted');
            btn.innerHTML = '<i class="fas fa-check"></i> –í–∞—à –≤—ã–±–æ—Ä';
        } else {
            btn.classList.remove('voted');
            btn.innerHTML = '<i class="fas fa-vote-yea"></i> –ì–æ–ª–æ—Å–æ–≤–∞—Ç—å';
        }
    });
}

// –†–µ–Ω–¥–µ—Ä–∏–Ω–≥ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏—è
function renderVotingResults() {
    console.log('üéØ –†–µ–Ω–¥–µ—Ä–∏–Ω–≥ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏—è...');
    renderChart();
    renderVotesList();
}

// –†–µ–Ω–¥–µ—Ä–∏–Ω–≥ —Å–ø–∏—Å–∫–∞ –≥–æ–ª–æ—Å–æ–≤
function renderVotesList() {
    const container = document.getElementById('votes-list');
    if (!container) {
        console.log('‚ùå –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä —Å–ø–∏—Å–∫–∞ –≥–æ–ª–æ—Å–æ–≤ –Ω–µ –Ω–∞–π–¥–µ–Ω');
        return;
    }
    
    const searchTerm = document.getElementById('votes-search')?.value.toLowerCase() || '';
    
    let filteredUsers = votingData ? Object.entries(votingData) : [];
    
    // –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ –ø–æ–∏—Å–∫—É
    if (searchTerm) {
        filteredUsers = filteredUsers.filter(([key, user]) => {
            if (!user) return false;
            const userName = user.name || '';
            const userVotes = Array.isArray(user.votedFor) ? user.votedFor : [];
            return userName.toLowerCase().includes(searchTerm) ||
                   userVotes.some(place => place && place.toLowerCase().includes(searchTerm));
        });
    }
    
    console.log('üë• –†–µ–Ω–¥–µ—Ä–∏–º —Å–ø–∏—Å–æ–∫ –≥–æ–ª–æ—Å–æ–≤:', filteredUsers);
    
    if (filteredUsers.length === 0) {
        container.innerHTML = `
            <div class="no-votes" style="text-align: center; padding: 2rem; color: var(--text-muted);">
                <i class="fas fa-users" style="font-size: 3rem; margin-bottom: 1rem; opacity: 0.5;"></i>
                <p>${searchTerm ? '–ù–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ' : '–ü–æ–∫–∞ –Ω–∏–∫—Ç–æ –Ω–µ –ø—Ä–æ–≥–æ–ª–æ—Å–æ–≤–∞–ª'}</p>
            </div>
        `;
        return;
    }
    
    container.innerHTML = filteredUsers.map(([key, user]) => {
        if (!user) return '';
        
        const userVotes = Array.isArray(user.votedFor) ? user.votedFor : [];
        
        return `
            <div class="vote-item">
                <div class="voter-avatar">${user.avatar || '?'}</div>
                <div class="voter-info">
                    <div class="voter-name">${user.name || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π'}</div>
                    <div class="voter-role">${user.role || '–£—á–µ–Ω–∏–∫'}</div>
                    ${userVotes.length > 0 ? `
                        <div class="vote-selection">
                            ${userVotes.map(place => `
                                <span class="voted-place">
                                    <i class="fas fa-map-marker-alt"></i>
                                    ${place}
                                </span>
                            `).join('')}
                        </div>
                    ` : '<div class="vote-selection" style="color: var(--text-muted); font-size: 0.9rem;">–ï—â—ë –Ω–µ –≥–æ–ª–æ—Å–æ–≤–∞–ª</div>'}
                </div>
                ${key === currentUserKey ? `
                    <div class="vote-actions">
                        <button class="change-vote-btn">
                            <i class="fas fa-edit"></i>
                            –ò–∑–º–µ–Ω–∏—Ç—å
                        </button>
                    </div>
                ` : ''}
            </div>
        `;
    }).join('');
}

// –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è –≥–æ–ª–æ—Å–æ–≤
function showVotingModal() {
    // –ì–ê–†–ê–ù–¢–ò–†–£–ï–ú –±–µ–∑–æ–ø–∞—Å–Ω—ã–π –¥–æ—Å—Ç—É–ø –∫ –¥–∞–Ω–Ω—ã–º
    const currentUserData = votingData[currentUserKey];
    const currentUserVotes = currentUserData && Array.isArray(currentUserData.votedFor) 
        ? currentUserData.votedFor 
        : [];
    
    let modalHTML = `
        <div class="image-modal show" id="voting-modal">
            <div class="image-modal-content" style="max-width: 600px;">
                <button class="close-image-btn" onclick="hideVotingModal()">
                    <i class="fas fa-times"></i>
                </button>
                <div style="padding: 2rem;">
                    <h2 style="font-family: 'Playfair Display', serif; margin-bottom: 1.5rem; text-align: center;">
                        –í–∞—à–∏ –≥–æ–ª–æ—Å–∞
                    </h2>
                    <div style="margin-bottom: 2rem; color: var(--text-secondary); text-align: center;">
                        –í—ã–±–µ—Ä–∏—Ç–µ –∑–∞–≤–µ–¥–µ–Ω–∏—è, –∫–æ—Ç–æ—Ä—ã–µ –≤–∞–º –Ω—Ä–∞–≤—è—Ç—Å—è
                    </div>
                    <div class="voting-options" style="display: grid; gap: 1rem; max-height: 400px; overflow-y: auto;">
    `;
    
    Object.keys(placesData).forEach(placeName => {
        const isVoted = currentUserVotes.includes(placeName);
        modalHTML += `
            <div class="voting-option" style="display: flex; align-items: center; gap: 1rem; padding: 1rem; background: rgba(255,255,255,0.03); border-radius: 12px; border: 1px solid ${isVoted ? 'var(--accent)' : 'var(--border)'};">
                <label style="display: flex; align-items: center; gap: 1rem; cursor: pointer; flex: 1;">
                    <input type="checkbox" ${isVoted ? 'checked' : ''} value="${placeName}" 
                           style="accent-color: var(--accent); transform: scale(1.2);">
                    <span style="color: var(--text-primary); font-weight: 500;">${placeName}</span>
                </label>
            </div>
        `;
    });
    
    modalHTML += `
                    </div>
                    <div style="display: flex; gap: 1rem; margin-top: 2rem;">
                        <button onclick="hideVotingModal()" style="flex: 1; padding: 1rem; background: rgba(255,255,255,0.05); border: 1px solid var(--border); color: var(--text-primary); border-radius: 8px; cursor: pointer;">
                            –û—Ç–º–µ–Ω–∞
                        </button>
                        <button onclick="saveVotesFromModal()" style="flex: 1; padding: 1rem; background: var(--gradient-primary); border: none; color: white; border-radius: 8px; cursor: pointer; font-weight: 600;">
                            –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤—ã–±–æ—Ä
                        </button>
                    </div>
                </div>
            </div>
        </div>
    `;
    
    // –î–æ–±–∞–≤–ª—è–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –≤ body
    const modalContainer = document.createElement('div');
    modalContainer.innerHTML = modalHTML;
    document.body.appendChild(modalContainer);
    document.body.style.overflow = 'hidden';
}

function hideVotingModal() {
    const modal = document.getElementById('voting-modal');
    if (modal) {
        modal.remove();
    }
    document.body.style.overflow = 'auto';
}

function saveVotesFromModal() {
    const checkboxes = document.querySelectorAll('.voting-option input[type="checkbox"]:checked');
    const selectedPlaces = Array.from(checkboxes).map(cb => cb.value);
    
    if (!votingData[currentUserKey]) {
        const currentUser = users[currentUserKey];
        votingData[currentUserKey] = {
            name: currentUser.name,
            role: currentUser.role,
            avatar: currentUser.avatar,
            votedFor: []
        };
    }
    
    votingData[currentUserKey].votedFor = selectedPlaces;
    
    // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ Firebase
    saveVoteToFirebase(currentUserKey, votingData[currentUserKey]);
    hideVotingModal();
    showNotification('–í–∞—à–∏ –≥–æ–ª–æ—Å–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã! üó≥Ô∏è', 'success');
}

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è —Å–±—Ä–æ—Å–∞ –≤—Å–µ—Ö –≥–æ–ª–æ—Å–æ–≤ (–∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –æ—Å—Ç–æ—Ä–æ–∂–Ω–æ!)
function resetAllVotes() {
    if (confirm('‚ö†Ô∏è –í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —Å–±—Ä–æ—Å–∏—Ç—å –í–°–ï –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏—è? –≠—Ç–æ –¥–µ–π—Å—Ç–≤–∏–µ –Ω–µ–ª—å–∑—è –æ—Ç–º–µ–Ω–∏—Ç—å!')) {
        const updates = {};
        Object.keys(users).forEach(key => {
            updates['votes/' + key] = {
                name: users[key].name,
                role: users[key].role,
                avatar: users[key].avatar,
                votedFor: []
            };
        });
        
        window.db.ref().update(updates)
            .then(() => {
                showNotification('–í—Å–µ –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏—è —Å–±—Ä–æ—à–µ–Ω—ã! üîÑ', 'success');
                setTimeout(() => location.reload(), 1500);
            })
            .catch(error => {
                console.error('‚ùå –û—à–∏–±–∫–∞ —Å–±—Ä–æ—Å–∞:', error);
                showNotification('–û—à–∏–±–∫–∞ –ø—Ä–∏ —Å–±—Ä–æ—Å–µ –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏–π', 'error');
            });
    }
}

// –ü–æ–∏—Å–∫ –≤ —Å–ø–∏—Å–∫–µ –≥–æ–ª–æ—Å–æ–≤
function setupVotesSearch() {
    const searchInput = document.getElementById('votes-search');
    if (searchInput) {
        searchInput.addEventListener('input', renderVotesList);
    }
}

// –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π
loginBtn.addEventListener('click', login);

accessKeyInput.addEventListener('keypress', (e) => {
    if (e.key === 'Enter') {
        login();
    }
});

logoutBtn.addEventListener('click', logout);

closeMapModal.addEventListener('click', hideMap);

closeImageModal.addEventListener('click', hideFullscreenImage);

prevImageBtn.addEventListener('click', prevImage);
nextImageBtn.addEventListener('click', nextImage);

// –ó–∞–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª—å–Ω—ã—Ö –æ–∫–æ–Ω –ø—Ä–∏ –∫–ª–∏–∫–µ –≤–Ω–µ –∏—Ö
mapModal.addEventListener('click', (e) => {
    if (e.target === mapModal) {
        hideMap();
    }
});

imageModal.addEventListener('click', (e) => {
    if (e.target === imageModal) {
        hideFullscreenImage();
    }
});

// –ó–∞–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª—å–Ω—ã—Ö –æ–∫–æ–Ω –ø–æ ESC –∏ –Ω–∞–≤–∏–≥–∞—Ü–∏—è –ø–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è–º
document.addEventListener('keydown', (e) => {
    if (e.key === 'Escape') {
        if (mapModal.classList.contains('show')) {
            hideMap();
        }
        if (imageModal.classList.contains('show')) {
            hideFullscreenImage();
        }
        
        // –ó–∞–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏—è
        const votingModal = document.getElementById('voting-modal');
        if (votingModal) {
            hideVotingModal();
        }
    }
    
    // –ù–∞–≤–∏–≥–∞—Ü–∏—è –ø–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è–º —Å –ø–æ–º–æ—â—å—é –∫–ª–∞–≤–∏—à
    if (imageModal.classList.contains('show')) {
        if (e.key === 'ArrowLeft') {
            prevImage();
        } else if (e.key === 'ArrowRight') {
            nextImage();
        }
    }
});

// –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –∫–Ω–æ–ø–æ–∫ –¥–µ–π—Å—Ç–≤–∏–π
document.addEventListener('click', (e) => {
    // –ö–Ω–æ–ø–∫–∞ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è —Ñ–æ—Ç–æ/–∏–∫–æ–Ω–∫–∏
    if (e.target.classList.contains('toggle-image-btn') || 
        e.target.closest('.toggle-image-btn')) {
        const btn = e.target.classList.contains('toggle-image-btn') ? 
                   e.target : e.target.closest('.toggle-image-btn');
        const card = btn.closest('.place-card');
        toggleImage(card);
    }
    
    // –ö–Ω–æ–ø–∫–∞ —Ä–∞–∑–≤–µ—Ä–Ω—É—Ç—å —Ñ–æ—Ç–æ (—Ç–µ–ø–µ—Ä—å –≤ –ª–µ–≤–æ–º –≤–µ—Ä—Ö–Ω–µ–º —É–≥–ª—É)
    if (e.target.classList.contains('expand-image-btn') || 
        e.target.closest('.expand-image-btn')) {
        const btn = e.target.classList.contains('expand-image-btn') ? 
                   e.target : e.target.closest('.expand-image-btn');
        const card = btn.closest('.place-card');
        const placeName = card.querySelector('.card-title').textContent;
        showFullscreenImage(placeName);
    }
    
    // –û—Å—Ç–∞–ª—å–Ω—ã–µ –∫–Ω–æ–ø–∫–∏ –¥–µ–π—Å—Ç–≤–∏–π
    if (e.target.classList.contains('action-btn') || 
        e.target.closest('.action-btn')) {
        const btn = e.target.classList.contains('action-btn') ? e.target : e.target.closest('.action-btn');
        const card = btn.closest('.place-card');
        const placeName = card.querySelector('.card-title').textContent;
        const place = placesData[placeName];
        
        if (btn.classList.contains('primary')) {
            if (btn.querySelector('.fa-vk') && place.social) {
                // –û—Ç–∫—Ä—ã–≤–∞–µ–º VK
                if (place.social.includes('vk.com')) {
                    window.open(`https://${place.social}`, '_blank');
                } else {
                    window.open(place.social, '_blank');
                }
            } else if (btn.querySelector('.fa-globe') && place.social) {
                // –û—Ç–∫—Ä—ã–≤–∞–µ–º —Å–∞–π—Ç
                window.open(`https://${place.social}`, '_blank');
            } else if (btn.querySelector('.fa-phone') && place.phone) {
                // –ó–≤–æ–Ω–æ–∫
                window.open(`tel:${place.phone.replace(/[^0-9+]/g, '')}`, '_self');
            } else {
                showNotification('–ö–æ–Ω—Ç–∞–∫—Ç–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è —Å–∫–æ—Ä–æ –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–Ω–∞! üìû');
            }
        } else if (btn.querySelector('.fa-map-marker-alt') || btn.textContent.includes('–∫–∞—Ä—Ç–µ')) {
            showMap(placeName);
        } else {
            showNotification('–§—É–Ω–∫—Ü–∏—è —Å–∫–æ—Ä–æ –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–Ω–∞! ‚ö°');
        }
    }
});

// –ê–Ω–∏–º–∞—Ü–∏—è —Ç—Ä—è—Å–∫–∏ –¥–ª—è –æ—à–∏–±–æ–∫
const style = document.createElement('style');
style.textContent = `
    @keyframes shake {
        0%, 100% { transform: translateX(0); }
        25% { transform: translateX(-5px); }
        75% { transform: translateX(5px); }
    }
`;
document.head.appendChild(style);

// –ü–æ–∫–∞–∑ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –Ω–æ–≤–æ–º –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏–∏
window.addEventListener('storage', (e) => {
    if (e.key === 'sborVotingData') {
        showNotification('–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω—ã! üîÑ', 'success');
        loadVotingDataFromFirebase();
        renderVotingResults();
        updateVoteButtons();
    }
});

// –ö–æ–Ω—Å–æ–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
console.log('üå≤ –ü—Ä–µ–º–∏—É–º –≥–∏–¥ –°–æ—Å–Ω–æ–≤—ã–π –ë–æ—Ä - –î–æ—Å—Ç—É–ø–Ω—ã–µ –∫–ª—é—á–∏:');
console.log('‚≠ê –û—Å–æ–±—ã–µ –∫–ª—é—á–∏:');
console.log('   B4G5R6T7 - –ë–µ–±–∏—è –ë–∞–≥—Ä–∞—Ç (–í–ª–∞–¥–µ–ª–µ—Ü —Å–∞–π—Ç–∞)');
console.log('   L1A2R3I4 - –ê–ª–±–∞–µ–≤–∞ –õ–∞—Ä–∏—Å–∞ –ö–∞–¥—ã—Ä–æ–≤–Ω–∞ (–£—á–∏—Ç–µ–ª—å)');
console.log('   E9L0I1Z2 - –ù–∞–¥—å—è—Ä–Ω–∞—è –ï–ª–∏–∑–∞–≤–µ—Ç–∞ (–°–ø—è—â–∞—è –ö—Ä–∞—Å–∞–≤–∏—Ü–∞)');
console.log('');
console.log('üè™ –î–æ—Å—Ç—É–ø–Ω—ã–µ –º–µ—Å—Ç–∞ –Ω–∞ –∫–∞—Ä—Ç–µ:');
Object.keys(placesData).forEach(place => {
    console.log(`   üìç ${place} - ${placesData[place].address}`);
});
console.log('');
console.log('üó≥Ô∏è –°–∏—Å—Ç–µ–º–∞ –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏—è —Å Firebase –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω–∞!');
console.log('–î–æ—Å—Ç—É–ø–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã:');
console.log('   - showVotingModal() - –æ—Ç–∫—Ä—ã—Ç—å –æ–∫–Ω–æ –≤—ã–±–æ—Ä–∞ –≥–æ–ª–æ—Å–æ–≤');
console.log('   - renderVotingResults() - –ø–µ—Ä–µ—Ä–∏—Å–æ–≤–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã');
console.log('   - resetAllVotes() - —Å–±—Ä–æ—Å–∏—Ç—å –≤—Å–µ –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏—è (–æ—Å—Ç–æ—Ä–æ–∂–Ω–æ!)');
console.log('   - debugUserInfo() - –æ—Ç–ª–∞–¥–æ—á–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è');

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ
function debugUserInfo() {
    console.log('üîç –û—Ç–ª–∞–¥–æ—á–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è:');
    console.log('   currentUserKey:', currentUserKey);
    console.log('   votingData[currentUserKey]:', votingData[currentUserKey]);
    console.log('   localStorage currentUser:', localStorage.getItem('currentUser'));
}
