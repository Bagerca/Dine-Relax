// –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∏ –∏—Ö –∫–ª—é—á–µ–π
const users = {
    // –£—á–µ–Ω–∏–∫–∏
    'S0F1A2B3': { name: '–ê–π—Ä–∞–ø–µ—Ç—è–Ω—Ü –°–æ—Ñ–∏—è', role: '–£—á–µ–Ω–∏–∫', avatar: '–°–ê' },
    'B4G5R6T7': { name: '–ë–µ–±–∏—è –ë–∞–≥—Ä–∞—Ç', role: '–í–ª–∞–¥–µ–ª–µ—Ü —Å–∞–π—Ç–∞', avatar: '–ë–ë' },
    'D8M9T0R1': { name: '–ë–µ–ª—è–µ–≤ –î–º–∏—Ç—Ä–∏–π', role: '–£—á–µ–Ω–∏–∫', avatar: '–î–ë' },
    'A2R3T4M5': { name: '–ë–æ–∂–µ—Å–∫–∏–π –ê—Ä—Ç—ë–º', role: '–£—á–µ–Ω–∏–∫', avatar: '–ê–ë' },
    'V6E7R8O9': { name: '–ë—É–Ω–∫–æ–≤—Å–∫–∞—è –í–µ—Ä–æ–Ω–∏–∫–∞', role: '–£—á–µ–Ω–∏–∫', avatar: '–í–ë' },
    'U1L2Y3A4': { name: '–í–∞–ª–µ–µ–≤–∞ –£–ª—å—è–Ω–∞', role: '–£—á–µ–Ω–∏–∫', avatar: '–£–í' },
    'E5L6I7Z8': { name: '–í–æ—Ä–æ–±–µ–ª—å –ï–ª–∏–∑–∞–≤–µ—Ç–∞', role: '–£—á–µ–Ω–∏–∫', avatar: '–ï–í' },
    'K9A0R1I2': { name: '–ì–∞—Ç–∏–∫–æ–µ–≤–∞ –ö–∞—Ä–∏–Ω–∞', role: '–£—á–µ–Ω–∏–∫', avatar: '–ö–ì' },
    'P3O4L5I6': { name: '–ì–µ—Ä–∞—Å–∏–º–æ–≤–∞ –ü–æ–ª–∏–Ω–∞', role: '–£—á–µ–Ω–∏–∫', avatar: '–ü–ì' },
    'M7A8X9I0': { name: '–ì–æ—Ä–ª–æ–≤ –ú–∞–∫—Å–∏–º', role: '–£—á–µ–Ω–∏–∫', avatar: '–ú–ì' },
    'V1E2R3O4': { name: '–î–µ–º–∏–¥–æ–≤–∏—á –í–µ—Ä–æ–Ω–∏–∫–∞', role: '–£—á–µ–Ω–∏–∫', avatar: '–í–î' },
    'A5N6D7R8': { name: '–î—Ä—ã–±–∞–ª–æ–≤ –ê–Ω–¥—Ä–µ–π', role: '–£—á–µ–Ω–∏–∫', avatar: '–ê–î' },
    'K9I0R1A2': { name: '–ï–ª—Å—É–∫–æ–≤–∞ –ö–∏—Ä–∞', role: '–£—á–µ–Ω–∏–∫', avatar: '–ö–ï' },
    'Z3H4A5N6': { name: '–ï—Ä–º—É—Ö–∞–Ω–æ–≤ –ñ–∞–Ω–∞—Ö–º–µ–¥', role: '–£—á–µ–Ω–∏–∫', avatar: '–ñ–ï' },
    'L7I8A9N0': { name: '–ö–∞–ª–∏–Ω–∏–Ω–∞ –õ–∏–∞–Ω–∞', role: '–£—á–µ–Ω–∏–∫', avatar: '–õ–ö' },
    'E1V2G3E4': { name: '–ö–æ—á–º–∞—Ä –ï–≤–≥–µ–Ω–∏—è', role: '–£—á–µ–Ω–∏–∫', avatar: '–ï–ö' },
    'E5L6I7Z8': { name: '–õ–µ–æ–Ω—Ç—å–µ–≤–∞ –ï–ª–∏–∑–∞–≤–µ—Ç–∞', role: '–£—á–µ–Ω–∏–∫', avatar: '–ï–õ' },
    'E9L0I1Z2': { name: '–ù–∞–¥—å—è—Ä–Ω–∞—è –ï–ª–∏–∑–∞–≤–µ—Ç–∞', role: '–£—á–µ–Ω–∏–∫', avatar: '–ï–ù' },
    'K3S4E5N6': { name: '–û—á–∞–∫–æ–≤–∞ –ö—Å–µ–Ω–∏—è', role: '–£—á–µ–Ω–∏–∫', avatar: '–ö–û' },
    'A7L8I9N0': { name: '–ü—è–∂–∏–µ–≤–∞ –ê–ª–∏–Ω–∞', role: '–£—á–µ–Ω–∏–∫', avatar: '–ê–ü' },
    'K1I2R3I4': { name: '–†–∞–¥–∏–≤–∏–ª–æ–≤ –ö–∏—Ä–∏–ª–ª', role: '–£—á–µ–Ω–∏–∫', avatar: '–ö–†' },
    'G5R6I7G8': { name: '–†—ã–±–∞–∫ –ì—Ä–∏–≥–æ—Ä–∏–π', role: '–£—á–µ–Ω–∏–∫', avatar: '–ì–†' },
    'K9I0R1I2': { name: '–®–∞—Ä–∏–Ω –ö–∏—Ä–∏–ª–ª', role: '–£—á–µ–Ω–∏–∫', avatar: '–ö–®' },
    'E3K4A5T6': { name: '–®–∏–ª–æ–≤–∞ –ï–∫–∞—Ç–µ—Ä–∏–Ω–∞', role: '–£—á–µ–Ω–∏–∫', avatar: '–ï–®' },
    'P7O8L9I0': { name: '–Ø–Ω—Ü–µ–≤–∏—á –ü–æ–ª–∏–Ω–∞', role: '–£—á–µ–Ω–∏–∫', avatar: '–ü–Ø' },
    
    // –£—á–∏—Ç–µ–ª—å
    'L1A2R3I4': { name: '–ê–ª–±–∞–µ–≤–∞ –õ–∞—Ä–∏—Å–∞ –ö–∞–¥—ã—Ä–æ–≤–Ω–∞', role: '–£—á–∏—Ç–µ–ª—å', avatar: '–õ–ê' }
};

// –î–∞–Ω–Ω—ã–µ –æ –º–µ—Å—Ç–∞—Ö —Å –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∞–º–∏
const placesData = {
    '–ö–æ—Ñ–µ–π–Ω—è ¬´Veranda¬ª': {
        coords: [59.880945, 29.112260],
        address: '–°–æ—Å–Ω–æ–≤—ã–π –ë–æ—Ä, –°–æ–ª–Ω–µ—á–Ω–∞—è —É–ª–∏—Ü–∞, 12, –¢–†–ö ¬´–ì–∞–ª–∞–∫—Ç–∏–∫–∞¬ª',
        description: '–°–ø–µ—à–µ–ª—Ç–∏ –∫–æ—Ñ–µ–π–Ω—è —Å–æ —Å–≤–µ–∂–µ–æ–±–∂–∞—Ä–µ–Ω–Ω—ã–º –∑–µ—Ä–Ω–æ–º, –¥–æ–º–∞—à–Ω–∏–º–∏ –¥–µ—Å–µ—Ä—Ç–∞–º–∏ –∏ –≤–µ–≥–µ—Ç–∞—Ä–∏–∞–Ω—Å–∫–∏–º–∏ –±–ª—é–¥–∞–º–∏',
        phone: '+7 (921) 904-69-20',
        workingHours: '–ü–Ω-–ß—Ç: 10:00‚Äì20:00, –ü—Ç-–í—Å: 10:00‚Äì21:00',
        rating: 4.8,
        reviewsCount: 334,
        price: '$$',
        features: ['Wi-Fi', '–ü–∞—Ä–∫–æ–≤–∫–∞', '–¢–µ—Ä—Ä–∞—Å–∞', '–î–æ—Å—Ç—É–ø–Ω–æ —Å –∂–∏–≤–æ—Ç–Ω—ã–º–∏', '–ë–µ—Å–ø–ª–∞—Ç–Ω–∞—è –≤–æ–¥–∞'],
        social: 'vk.com/verandacoffee'
    },
    '–ö–∞—Ñ–µ-–ø–µ–∫–∞—Ä–Ω—è ¬´–ú–æ–π –°–æ—Å–Ω–æ–≤—ã–π –ë–æ—Ä¬ª': {
        coords: [59.880816, 29.112933],
        address: '–°–æ—Å–Ω–æ–≤—ã–π –ë–æ—Ä, –°–æ–ª–Ω–µ—á–Ω–∞—è —É–ª–∏—Ü–∞, 9',
        description: '–£—é—Ç–Ω–∞—è –∫–æ—Ñ–µ–π–Ω—è-–ø–µ–∫–∞—Ä–Ω—è —Å –±–æ–ª—å—à–æ–π –≤—ã–±–æ—Ä–æ–º –¥–µ—Å–µ—Ä—Ç–æ–≤, —Å—ã—Ç–Ω—ã—Ö –±–ª—é–¥ –∏ –¥–µ—Ç—Å–∫–æ–π –∫–æ–º–Ω–∞—Ç–æ–π',
        phone: '+7 (921) 882-40-02',
        workingHours: '–ü–Ω-–ü—Ç: 09:00‚Äì22:00, –°–±-–í—Å: 10:00‚Äì22:00',
        rating: 4.5,
        reviewsCount: 390,
        price: '$$',
        features: ['Wi-Fi', '–ü–∞—Ä–∫–æ–≤–∫–∞', '–õ–µ—Ç–Ω—è—è –≤–µ—Ä–∞–Ω–¥–∞', '–î–µ—Ç—Å–∫–∞—è –∫–æ–º–Ω–∞—Ç–∞', '–î–æ—Å—Ç–∞–≤–∫–∞'],
        social: 'vk.com/coffeesbor'
    },
    '–†–µ—Å—Ç–æ—Ä–∞–Ω ¬´–ü—Ö–∞–ª–∏–•–∏–Ω–∫–∞–ª–∏¬ª': {
        coords: [59.880479, 29.117188],
        address: '–°–æ—Å–Ω–æ–≤—ã–π –ë–æ—Ä, –õ–µ–Ω–∏–Ω–≥—Ä–∞–¥—Å–∫–∞—è —É–ª–∏—Ü–∞, 46',
        description: '–ê—É—Ç–µ–Ω—Ç–∏—á–Ω—ã–π —Ä–µ—Å—Ç–æ—Ä–∞–Ω –≥—Ä—É–∑–∏–Ω—Å–∫–æ–π –∫—É—Ö–Ω–∏, –∏–∑–≤–µ—Å—Ç–Ω—ã–π —Å–æ—á–Ω—ã–º–∏ —Ö–∏–Ω–∫–∞–ª–∏ –∏ —Ç—Ä–∞–¥–∏—Ü–∏–æ–Ω–Ω—ã–º–∏ –±–ª—é–¥–∞–º–∏',
        phone: '+7 (812) 904-44-90',
        workingHours: '–ü–Ω-–ß—Ç: 12:00‚Äì23:00, –ü—Ç-–°–±: 12:00‚Äì00:00, –í—Å: 12:00‚Äì23:00',
        rating: 4.6,
        reviewsCount: 1382,
        price: '$$',
        features: ['–î–µ—Ç—Å–∫–∞—è –ø–ª–æ—â–∞–¥–∫–∞', '–ë–∞–Ω–∫–µ—Ç–Ω—ã–π –∑–∞–ª', '–î–æ—Å—Ç–∞–≤–∫–∞', '–ñ–∏–≤–∞—è –º—É–∑—ã–∫–∞'],
        social: 'phali-hinkali.ru/sbr'
    },
    '–†–µ—Å—Ç–æ—Ä–∞–Ω ¬´–¢–æ–∫–∏–æ-–°–∏—Ç–∏¬ª': {
        coords: [59.880945, 29.112260],
        address: '–°–æ—Å–Ω–æ–≤—ã–π –ë–æ—Ä, –°–æ–ª–Ω–µ—á–Ω–∞—è —É–ª–∏—Ü–∞, 12, –¢–†–ö ¬´–ì–∞–ª–∞–∫—Ç–∏–∫–∞¬ª, 3 —ç—Ç–∞–∂',
        description: '–†–µ—Å—Ç–æ—Ä–∞–Ω —Å —à–∏—Ä–æ–∫–∏–º –≤—ã–±–æ—Ä–æ–º –±–ª—é–¥ —è–ø–æ–Ω—Å–∫–æ–π, –∏—Ç–∞–ª—å—è–Ω—Å–∫–æ–π, –º–µ–∫—Å–∏–∫–∞–Ω—Å–∫–æ–π –∏ –¥—Ä—É–≥–∏—Ö –∫—É—Ö–æ–Ω—å',
        phone: '+7 (812) 677-41-12',
        workingHours: '–ü–Ω-–ß—Ç: 12:00‚Äì23:00, –ü—Ç-–°–±: 12:00‚Äì01:00, –í—Å: 12:00‚Äì23:00',
        rating: 3.9,
        reviewsCount: 26,
        price: '$$',
        features: ['600+ –ø–æ–∑–∏—Ü–∏–π –≤ –º–µ–Ω—é', '–î–æ—Å—Ç–∞–≤–∫–∞', '–ë—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ', '–î–µ—Ç—Å–∫–æ–µ –º–µ–Ω—é'],
        social: 'tokyo-city.ru/spb/restaurants/sosnovyy-bor'
    },
    '–ì–∞—Å—Ç—Ä–æ–±–∞—Ä ¬´–•–µ–≤–∞–∞¬ª': {
        coords: [59.897457, 29.117188],
        address: '–°–æ—Å–Ω–æ–≤—ã–π –ë–æ—Ä, –£—Å—Ç—å–∏–Ω—Å–∫–∞—è —É–ª–∏—Ü–∞, 11/2',
        description: '–ì—Ä–∏–ª—å-–±–∞—Ä –ø—Ä–∏ –∫–æ–º–ø–ª–µ–∫—Å–µ Hevaa —Å –±–ª—é–¥–∞–º–∏ –Ω–∞ –≥—Ä–∏–ª–µ, –±—É—Ä–≥–µ—Ä–∞–º–∏, —Å—Ç–µ–π–∫–∞–º–∏ –∏ —É—é—Ç–Ω–æ–π –∞—Ç–º–æ—Å—Ñ–µ—Ä–æ–π —É –º–æ—Ä—è',
        phone: '+7 (812) 220-15-22',
        workingHours: '–ö—Ä—É–≥–ª–æ—Å—É—Ç–æ—á–Ω–æ',
        rating: 4.3,
        reviewsCount: 1213,
        price: '$$',
        features: ['–ö—Ä—É–≥–ª–æ—Å—É—Ç–æ—á–Ω–æ', '–ë–µ—Å–µ–¥–∫–∏', '–õ–µ—Ç–Ω—è—è –ø–ª–æ—â–∞–¥–∫–∞', '–ì—Ä–∏–ª—å', '–ö–æ–∫—Ç–µ–π–ª–∏'],
        social: 'hevaa.ru'
    },
    '–ì—Ä–∞–Ω–¥-–∫–∞—Ñ–µ ¬´–ë–∞–≥—Ä–∞—Ç–∏–æ–Ω¬ª': {
        coords: [59.886361, 29.117621],
        address: '–°–æ—Å–Ω–æ–≤—ã–π –ë–æ—Ä, –ü—Ä–æ—Å–ø–µ–∫—Ç –ì–µ—Ä–æ–µ–≤, 65A',
        description: '–ì—Ä–∞–Ω–¥-–∫–∞—Ñ–µ —Å —Ä–∞–∑–Ω–æ–æ–±—Ä–∞–∑–Ω–æ–π –µ–≤—Ä–æ–ø–µ–π—Å–∫–æ–π –∏ –≥—Ä—É–∑–∏–Ω—Å–∫–æ–π –∫—É—Ö–Ω–µ–π, –∂–∏–≤–æ–π –º—É–∑—ã–∫–æ–π –∏ —É—é—Ç–Ω–æ–π –∞—Ç–º–æ—Å—Ñ–µ—Ä–æ–π',
        phone: '+7 (965) 752-22-82',
        workingHours: '–ü–Ω-–ß—Ç: 11:00‚Äì23:00, –ü—Ç-–°–±: 11:00‚Äì01:00, –í—Å: 11:00‚Äì23:00',
        rating: 4.3,
        reviewsCount: 260,
        price: '$$',
        features: ['–ñ–∏–≤–∞—è –º—É–∑—ã–∫–∞', '–î–æ—Å—Ç–∞–≤–∫–∞', '–ë–µ—Å–ø–ª–∞—Ç–Ω–∞—è –ø–∞—Ä–∫–æ–≤–∫–∞', '–ï–≤—Ä–æ–ø–µ–π—Å–∫–∞—è –∫—É—Ö–Ω—è'],
        social: ''
    },
    '–ö–∏–Ω–æ—Ç–µ–∞—Ç—Ä ¬´–°–æ–≤—Ä–µ–º–µ–Ω–Ω–∏–∫¬ª': {
        coords: [59.91185, 29.07062],
        address: '–°–æ—Å–Ω–æ–≤—ã–π –ë–æ—Ä, –ö–æ–º—Å–æ–º–æ–ª—å—Å–∫–∞—è —É–ª–∏—Ü–∞, 17',
        description: '–ì–æ—Ä–æ–¥—Å–∫–æ–π –∫–∏–Ω–æ—Ç–µ–∞—Ç—Ä —Å —Å—É—à–∏-–±–∞—Ä–æ–º ¬´–ö–∏–Ω-–Ω–æ¬ª. –£–¥–æ–±–Ω—ã–µ –∫—Ä–µ—Å–ª–∞, —Ö–æ—Ä–æ—à–µ–µ –∫–∞—á–µ—Å—Ç–≤–æ –∑–≤—É–∫–∞. –ò–¥–µ–∞–ª—å–Ω–æ–µ –º–µ—Å—Ç–æ –¥–ª—è –æ—Ç–¥—ã—Ö–∞ —Å –ø—Ä–æ—Å–º–æ—Ç—Ä–æ–º —Ñ–∏–ª—å–º–æ–≤ –∏ —è–ø–æ–Ω—Å–∫–æ–π –∫—É—Ö–Ω–µ–π.',
        phone: '+7 (81369) 2-12-32',
        workingHours: '–ö–∏–Ω–æ—Ç–µ–∞—Ç—Ä: 11:00‚Äì00:00, –ë–∞—Ä ¬´–ö–∏–Ω-–Ω–æ¬ª: 12:00‚Äì02:00 (–¥–æ 03:00 –ü—Ç-–°–±)',
        rating: 3.9,
        reviewsCount: 1000,
        price: '$$',
        features: ['–°—É—à–∏-–±–∞—Ä ¬´–ö–∏–Ω-–Ω–æ¬ª', '–£–¥–æ–±–Ω—ã–µ –∫—Ä–µ—Å–ª–∞', '–•–æ—Ä–æ—à–∏–π –∑–≤—É–∫', '–ù–µ—Å–∫–æ–ª—å–∫–æ –∑–∞–ª–æ–≤', '–Ø–ø–æ–Ω—Å–∫–∞—è –∫—É—Ö–Ω–∏'],
        social: 'sovremennik.sbor.net'
    }
};

// –î–∞–Ω–Ω—ã–µ —Å –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è–º–∏ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –∑–∞–≤–µ–¥–µ–Ω–∏—è
const placeImages = {
    '–ö–æ—Ñ–µ–π–Ω—è ¬´Veranda¬ª': [
        'https://avatars.mds.yandex.net/get-altay/13054604/2a00000190a77560adb2066c2b0ff460732b/XXXL',
        'https://avatars.mds.yandex.net/get-altay/14014620/2a000001912c9dca1b4e62d778d484446b94/XXXL',
        'https://avatars.mds.yandex.net/get-altay/5456504/2a0000017c7ea8dd69a6f7b112b5640b870d/XXXL'
    ],
    '–ö–∞—Ñ–µ-–ø–µ–∫–∞—Ä–Ω—è ¬´–ú–æ–π –°–æ—Å–Ω–æ–≤—ã–π –ë–æ—Ä¬ª': [
        'https://example.com/moy-sbor-interior.jpg',
        'https://example.com/moy-sbor-bakery.jpg'
    ],
    '–†–µ—Å—Ç–æ—Ä–∞–Ω ¬´–ü—Ö–∞–ª–∏–•–∏–Ω–∫–∞–ª–∏¬ª': [
        'https://example.com/phali-dishes.jpg',
        'https://example.com/phali-interior.jpg',
        'https://example.com/phali-hinkali.jpg'
    ],
    '–†–µ—Å—Ç–æ—Ä–∞–Ω ¬´–¢–æ–∫–∏–æ-–°–∏—Ç–∏¬ª': [
        'https://example.com/tokyo-interior.jpg',
        'https://example.com/tokyo-sushi.jpg'
    ],
    '–ì—Ä–∞–Ω–¥-–∫–∞—Ñ–µ ¬´–ë–∞–≥—Ä–∞—Ç–∏–æ–Ω¬ª': [
        'https://example.com/bagration-hall.jpg',
        'https://example.com/bagration-food.jpg'
    ],
    '–ì–∞—Å—Ç—Ä–æ–±–∞—Ä ¬´–•–µ–≤–∞–∞¬ª': [
        'https://example.com/hevaa-terrace.jpg',
        'https://example.com/hevaa-grill.jpg',
        'https://example.com/hevaa-cocktails.jpg'
    ],
    '–ö–∏–Ω–æ—Ç–µ–∞—Ç—Ä ¬´–°–æ–≤—Ä–µ–º–µ–Ω–Ω–∏–∫¬ª': [
        'https://example.com/sovremennik-building.jpg',
        'https://example.com/sovremennik-hall.jpg',
        'https://example.com/sovremennik-bar.jpg'
    ]
};

// DOM —ç–ª–µ–º–µ–Ω—Ç—ã
const loginScreen = document.getElementById('login-screen');
const mainContent = document.getElementById('main-content');
const accessKeyInput = document.getElementById('access-key');
const loginBtn = document.getElementById('login-btn');
const userInfo = document.getElementById('user-info');
const userAvatar = document.getElementById('user-avatar');
const userName = document.getElementById('user-name');
const userRole = document.getElementById('user-role');
const welcomeName = document.getElementById('welcome-name');
const logoutBtn = document.getElementById('logout-btn');

// –≠–ª–µ–º–µ–Ω—Ç—ã –∫–∞—Ä—Ç—ã
const mapModal = document.getElementById('map-modal');
const mapContainer = document.getElementById('map-container');
const mapPlaceTitle = document.getElementById('map-place-title');
const mapAddressText = document.getElementById('map-address-text');
const closeMapModal = document.getElementById('close-map-modal');

// –≠–ª–µ–º–µ–Ω—Ç—ã –¥–ª—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π
const imageModal = document.getElementById('image-modal');
const fullscreenImage = document.getElementById('fullscreen-image');
const imageModalTitle = document.getElementById('image-modal-title');
const closeImageModal = document.getElementById('close-image-modal');
const prevImageBtn = document.getElementById('prev-image');
const nextImageBtn = document.getElementById('next-image');
const currentImageElement = document.getElementById('current-image');
const totalImagesElement = document.getElementById('total-images');

// –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è–º–∏
let currentImages = [];
let currentImageIndex = 0;
let currentPlaceName = '';

// –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –∫–∞—Ä—Ç—ã
let ymap = null;
let currentPlace = null;

// –°–∏—Å—Ç–µ–º–∞ –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏—è
let votingData = {};
let currentUserKey = '';

// ================== FIREBASE –§–£–ù–ö–¶–ò–ò ==================

// –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏—è –∏–∑ Firebase
function loadVotingDataFromFirebase() {
    try {
        console.log('üîÑ –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö –∏–∑ Firebase...');
        const votesRef = window.db.ref('votes');
        votesRef.on('value', (snapshot) => {
            const data = snapshot.val();
            console.log('üìä –î–∞–Ω–Ω—ã–µ –ø–æ–ª—É—á–µ–Ω—ã –∏–∑ Firebase:', data);
            votingData = data || {};
            console.log('üìà votingData –ø–æ—Å–ª–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è:', votingData);
            renderVotingResults();
            updateVoteButtons();
        }, (error) => {
            console.error('‚ùå –û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∏–∑ Firebase:', error);
            showNotification('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥–∞–Ω–Ω—ã—Ö –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏—è', 'error');
        });
    } catch (error) {
        console.error('‚ùå –û—à–∏–±–∫–∞ –≤ loadVotingDataFromFirebase:', error);
    }
}

// –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≥–æ–ª–æ—Å–∞ –≤ Firebase
function saveVoteToFirebase(userKey, voteData) {
    return new Promise((resolve) => {
        try {
            const updates = {};
            updates['votes/' + userKey] = voteData;
            
            console.log('üíæ –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ Firebase:', updates);
            
            window.db.ref().update(updates)
                .then(() => {
                    console.log('‚úÖ –£—Å–ø–µ—à–Ω–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–æ –≤ Firebase');
                    resolve(true);
                })
                .catch((error) => {
                    console.error('‚ùå –û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –≤ Firebase:', error);
                    showNotification('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –≥–æ–ª–æ—Å–∞', 'error');
                    resolve(false);
                });
        } catch (error) {
            console.error('‚ùå –û—à–∏–±–∫–∞ –≤ saveVoteToFirebase:', error);
            resolve(false);
        }
    });
}

// –û–±–Ω–æ–≤–ª–µ–Ω–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏—è
async function handleVote(placeName) {
    console.log('üó≥Ô∏è –ù–∞—á–∞–ª–æ –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏—è –∑–∞:', placeName, '–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å:', currentUserKey);
    
    if (!currentUserKey) {
        showNotification('–î–ª—è –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏—è –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –≤–æ–π—Ç–∏ –≤ —Å–∏—Å—Ç–µ–º—É', 'error');
        return;
    }
    
    const currentUser = users[currentUserKey];
    if (!currentUser) {
        showNotification('–û—à–∏–±–∫–∞: –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –Ω–∞–π–¥–µ–Ω', 'error');
        return;
    }
    
    try {
        // –°–æ–∑–¥–∞–µ–º –∫–æ–ø–∏—é —Ç–µ–∫—É—â–∏—Ö –¥–∞–Ω–Ω—ã—Ö
        const userVotes = votingData[currentUserKey] ? [...votingData[currentUserKey].votedFor] : [];
        const hasVoted = userVotes.includes(placeName);
        
        let newVotes;
        if (hasVoted) {
            // –£–±–∏—Ä–∞–µ–º –≥–æ–ª–æ—Å
            newVotes = userVotes.filter(place => place !== placeName);
            showNotification(`–ì–æ–ª–æ—Å –∑–∞ "${placeName}" –æ—Ç–º–µ–Ω–µ–Ω`, 'success');
        } else {
            // –î–æ–±–∞–≤–ª—è–µ–º –≥–æ–ª–æ—Å
            newVotes = [...userVotes, placeName];
            showNotification(`–í—ã –ø—Ä–æ–≥–æ–ª–æ—Å–æ–≤–∞–ª–∏ –∑–∞ "${placeName}"! üëç`, 'success');
        }
        
        // –°–æ–∑–¥–∞–µ–º –æ–±—ä–µ–∫—Ç –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è
        const voteData = {
            name: currentUser.name,
            role: currentUser.role,
            avatar: currentUser.avatar,
            votedFor: newVotes
        };
        
        console.log('üìù –ù–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è:', voteData);
        
        // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ Firebase
        const success = await saveVoteToFirebase(currentUserKey, voteData);
        
        if (success) {
            // –û–±–Ω–æ–≤–ª—è–µ–º –ª–æ–∫–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
            votingData[currentUserKey] = voteData;
            console.log('üîÑ –õ–æ–∫–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –æ–±–Ω–æ–≤–ª–µ–Ω—ã:', votingData);
            
            // –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ –æ–±–Ω–æ–≤–ª—è–µ–º UI
            renderVotingResults();
            updateVoteButtons();
        }
        
    } catch (error) {
        console.error('‚ùå –û—à–∏–±–∫–∞ –≤ handleVote:', error);
        showNotification('–û—à–∏–±–∫–∞ –ø—Ä–∏ –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏–∏', 'error');
    }
}

// –û–±–Ω–æ–≤–ª–µ–Ω–Ω–∞—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å–∏—Å—Ç–µ–º—ã –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏—è
function initVotingSystem() {
    console.log('üöÄ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Å–∏—Å—Ç–µ–º—ã –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏—è...');
    votingData = {}; // –°–±—Ä–∞—Å—ã–≤–∞–µ–º –¥–∞–Ω–Ω—ã–µ
    loadVotingDataFromFirebase(); // –ó–∞–≥—Ä—É–∂–∞–µ–º –∑–∞–Ω–æ–≤–æ
    setupVotingButtons();
    setupVotesSearch();
}

// ================== –û–°–ù–û–í–ù–´–ï –§–£–ù–ö–¶–ò–ò ==================

// –ü—Ä–æ–≤–µ—Ä—è–µ–º, –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω –ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
window.addEventListener('load', () => {
    const savedUser = localStorage.getItem('currentUser');
    if (savedUser) {
        const user = JSON.parse(savedUser);
        showMainContent(user);
    } else {
        accessKeyInput.focus();
    }
});

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–∫–∞–∑–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
function showNotification(message, type = 'success') {
    const existingNotification = document.querySelector('.notification');
    if (existingNotification) {
        existingNotification.remove();
    }

    const notification = document.createElement('div');
    notification.className = `notification ${type}`;
    notification.textContent = message;
    
    document.body.appendChild(notification);

    setTimeout(() => {
        notification.classList.add('show');
    }, 100);

    setTimeout(() => {
        notification.classList.remove('show');
        setTimeout(() => {
            if (notification.parentNode) {
                notification.parentNode.removeChild(notification);
            }
        }, 300);
    }, 3000);
}

// –§—É–Ω–∫—Ü–∏—è —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∏–º–µ–Ω–∏ –¥–ª—è –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏—è
function formatDisplayName(user) {
    if (user.role === '–£—á–∏—Ç–µ–ª—å') {
        return '–õ–∞—Ä–∏—Å–∞ –ö.';
    } else if (user.role === '–í–ª–∞–¥–µ–ª–µ—Ü —Å–∞–π—Ç–∞') {
        return '–ë–∞–≥—Ä–∞—Ç';
    } else {
        const nameParts = user.name.split(' ');
        const lastName = nameParts[0];
        const firstNameInitial = nameParts[1] ? nameParts[1].charAt(0) + '.' : '';
        return `${lastName} ${firstNameInitial}`;
    }
}

// –§—É–Ω–∫—Ü–∏—è –ø–æ–∫–∞–∑–∞ –æ—Å–Ω–æ–≤–Ω–æ–≥–æ –∫–æ–Ω—Ç–µ–Ω—Ç–∞
function showMainContent(user) {
    const displayName = formatDisplayName(user);
    welcomeName.textContent = displayName;
    
    // –°–æ—Ö—Ä–∞–Ω—è–µ–º –∫–ª—é—á –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    if (users[user.key]) {
        currentUserKey = user.key;
    } else {
        // –ù–∞—Ö–æ–¥–∏–º –∫–ª—é—á –ø–æ –∏–º–µ–Ω–∏ (fallback)
        const userEntry = Object.entries(users).find(([key, u]) => u.name === user.name && u.role === user.role);
        if (userEntry) {
            currentUserKey = userEntry[0];
            user.key = currentUserKey; // —Å–æ—Ö—Ä–∞–Ω—è–µ–º –∫–ª—é—á –≤ –æ–±—ä–µ–∫—Ç–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        }
    }
    
    loginScreen.style.display = 'none';
    mainContent.style.display = 'block';
    
    if (user.role === '–í–ª–∞–¥–µ–ª–µ—Ü —Å–∞–π—Ç–∞') {
        showNotification('–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å, —Å–æ–∑–¥–∞—Ç–µ–ª—å! üéâ –í–∞—à —Å–∞–π—Ç –≤—ã–≥–ª—è–¥–∏—Ç –ø—Ä–µ–º–∏–∞–ª—å–Ω–æ!');
    } else if (user.role === '–£—á–∏—Ç–µ–ª—å') {
        showNotification('–ó–¥—Ä–∞–≤—Å—Ç–≤—É–π—Ç–µ, –õ–∞—Ä–∏—Å–∞ –ö–∞–¥—ã—Ä–æ–≤–Ω–∞! üë©‚Äçüè´ –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å!');
    } else {
        showNotification(`–î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å, ${displayName}! ‚ú® –¢–µ–ø–µ—Ä—å –≤—ã –º–æ–∂–µ—Ç–µ –≥–æ–ª–æ—Å–æ–≤–∞—Ç—å –∑–∞ –ª—é–±–∏–º—ã–µ –º–µ—Å—Ç–∞`);
    }

    window.scrollTo({ top: 0, behavior: 'smooth' });
    setTimeout(initCardAnimations, 500);
    
    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º —Å–∏—Å—Ç–µ–º—É –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏—è
    setTimeout(() => {
        initVotingSystem();
        updateVoteButtons();
        setupVotesSearch();
    }, 1000);
}

// –§—É–Ω–∫—Ü–∏—è –≤—Ö–æ–¥–∞
function login() {
    const key = accessKeyInput.value.trim().toUpperCase();
    
    if (!key) {
        showNotification('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤–≤–µ–¥–∏—Ç–µ –∫–ª—é—á –¥–æ—Å—Ç—É–ø–∞', 'error');
        return;
    }

    loginBtn.classList.add('loading');
    
    setTimeout(() => {
        const user = users[key];
        
        if (user) {
            userAvatar.textContent = user.avatar;
            userName.textContent = user.name;
            userRole.textContent = user.role;
            userInfo.classList.add('show');
            
            // –°–æ—Ö—Ä–∞–Ω—è–µ–º –∫–ª—é—á –≤ –æ–±—ä–µ–∫—Ç–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
            user.key = key;
            
            setTimeout(() => {
                localStorage.setItem('currentUser', JSON.stringify(user));
                showMainContent(user);
            }, 800);
            
        } else {
            showNotification('–ù–µ–≤–µ—Ä–Ω—ã–π –∫–ª—é—á –¥–æ—Å—Ç—É–ø–∞', 'error');
            accessKeyInput.style.animation = 'shake 0.5s';
            setTimeout(() => {
                accessKeyInput.style.animation = '';
            }, 500);
        }
        
        loginBtn.classList.remove('loading');
    }, 1200);
}

// –§—É–Ω–∫—Ü–∏—è –≤—ã—Ö–æ–¥–∞
function logout() {
    localStorage.removeItem('currentUser');
    accessKeyInput.value = '';
    userInfo.classList.remove('show');
    mainContent.style.display = 'none';
    loginScreen.style.display = 'flex';
    accessKeyInput.focus();
    showNotification('–í—ã –≤—ã—à–ª–∏ –∏–∑ —Å–∏—Å—Ç–µ–º—ã. –í–æ–∑–≤—Ä–∞—â–∞–π—Ç–µ—Å—å —Å–∫–æ—Ä–µ–µ! üëã');
}

// –§—É–Ω–∫—Ü–∏—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –∫–∞—Ä—Ç—ã
function initMap(placeName) {
    const place = placesData[placeName];
    if (!place) return;

    currentPlace = place;

    // –û—á–∏—â–∞–µ–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –∫–∞—Ä—Ç—ã
    mapContainer.innerHTML = '';
    
    // –°–æ–∑–¥–∞–µ–º –∫–∞—Ä—Ç—É
    ymap = new ymaps.Map(mapContainer, {
        center: place.coords,
        zoom: 16,
        controls: ['zoomControl', 'fullscreenControl']
    }, {
        searchControlProvider: 'yandex#search'
    });

    // –°–æ–∑–¥–∞–µ–º —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –±–∞–ª—É–Ω–∞
    const balloonContent = `
        <div style="padding: 15px; max-width: 300px; font-family: Arial, sans-serif;">
            <h3 style="margin: 0 0 10px 0; color: #333; font-size: 18px;">${placeName}</h3>
            <p style="margin: 0 0 8px 0; color: #666; font-size: 14px;">${place.description}</p>
            <div style="margin: 8px 0;">
                <strong style="color: #333;">üìû –¢–µ–ª–µ—Ñ–æ–Ω:</strong> 
                <span style="color: #666;">${place.phone}</span>
            </div>
            <div style="margin: 8px 0;">
                <strong style="color: #333;">üïí –í—Ä–µ–º—è —Ä–∞–±–æ—Ç—ã:</strong> 
                <span style="color: #666;">${place.workingHours}</span>
            </div>
            <div style="margin: 8px 0;">
                <strong style="color: #333;">‚≠ê –†–µ–π—Ç–∏–Ω–≥:</strong> 
                <span style="color: #666;">${place.rating} (${place.reviewsCount} –æ—Ç–∑—ã–≤–æ–≤)</span>
            </div>
            <div style="margin: 8px 0;">
                <strong style="color: #333;">üìç –ê–¥—Ä–µ—Å:</strong> 
                <span style="color: #666;">${place.address}</span>
            </div>
        </div>
    `;

    // –î–æ–±–∞–≤–ª—è–µ–º –º–µ—Ç–∫—É
    const placemark = new ymaps.Placemark(place.coords, {
        balloonContent: balloonContent
    }, {
        preset: 'islands#redDotIcon',
        balloonCloseButton: true,
        hideIconOnBalloonOpen: false
    });

    ymap.geoObjects.add(placemark);
    
    // –û—Ç–∫—Ä—ã–≤–∞–µ–º –±–∞–ª—É–Ω
    placemark.balloon.open();

    // –û–±–Ω–æ–≤–ª—è–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –≤ –º–æ–¥–∞–ª—å–Ω–æ–º –æ–∫–Ω–µ
    mapPlaceTitle.textContent = placeName;
    mapAddressText.textContent = place.address;
}

// –§—É–Ω–∫—Ü–∏—è –ø–æ–∫–∞–∑–∞ –∫–∞—Ä—Ç—ã
function showMap(placeName) {
    if (!placeName || !placesData[placeName]) {
        showNotification('–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ –º–µ—Å—Ç–æ–ø–æ–ª–æ–∂–µ–Ω–∏–∏ –≤—Ä–µ–º–µ–Ω–Ω–æ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞', 'error');
        return;
    }

    mapModal.classList.add('show');
    document.body.style.overflow = 'hidden';

    // –ï—Å–ª–∏ –Ø–Ω–¥–µ–∫—Å –ö–∞—Ä—Ç—ã —É–∂–µ –∑–∞–≥—Ä—É–∂–µ–Ω—ã, –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –∫–∞—Ä—Ç—É
    if (window.ymaps) {
        ymaps.ready(() => initMap(placeName));
    } else {
        // –ó–∞–≥—Ä—É–∂–∞–µ–º –Ø–Ω–¥–µ–∫—Å –ö–∞—Ä—Ç—ã
        const script = document.createElement('script');
        script.src = 'https://api-maps.yandex.ru/2.1/?lang=ru_RU';
        script.onload = () => {
            ymaps.ready(() => initMap(placeName));
        };
        document.head.appendChild(script);
    }
}

// –§—É–Ω–∫—Ü–∏—è —Å–∫—Ä—ã—Ç–∏—è –∫–∞—Ä—Ç—ã
function hideMap() {
    mapModal.classList.remove('show');
    document.body.style.overflow = 'auto';
    
    if (ymap) {
        ymap.destroy();
        ymap = null;
    }
}

// –§—É–Ω–∫—Ü–∏—è –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è –º–µ–∂–¥—É –∏–∫–æ–Ω–∫–æ–π –∏ —Ñ–æ—Ç–æ
function toggleImage(card) {
    const cardImage = card.querySelector('.card-image');
    const placeholder = cardImage.querySelector('.image-placeholder');
    const realImage = cardImage.querySelector('.real-image');
    const toggleBtn = cardImage.querySelector('.toggle-image-btn');
    
    if (realImage.classList.contains('active')) {
        // –í–æ–∑–≤—Ä–∞—â–∞–µ–º –∏–∫–æ–Ω–∫—É
        realImage.classList.remove('active');
        placeholder.classList.remove('hidden');
        toggleBtn.innerHTML = '<i class="fas fa-camera"></i> –§–æ—Ç–æ';
    } else {
        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Ñ–æ—Ç–æ
        const placeName = card.querySelector('.card-title').textContent;
        const images = placeImages[placeName];
        
        if (images && images.length > 0) {
            // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø–µ—Ä–≤–æ–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ
            realImage.style.backgroundImage = `url(${images[0]})`;
            realImage.classList.add('active');
            placeholder.classList.add('hidden');
            toggleBtn.innerHTML = '<i class="fas fa-palette"></i> –ò–∫–æ–Ω–∫–∞';
        } else {
            showNotification('–§–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏ –¥–ª—è —ç—Ç–æ–≥–æ –∑–∞–≤–µ–¥–µ–Ω–∏—è —Å–∫–æ—Ä–æ –ø–æ—è–≤—è—Ç—Å—è! üì∏', 'error');
        }
    }
}

// –§—É–Ω–∫—Ü–∏—è –ø–æ–∫–∞–∑–∞ –ø–æ–ª–Ω–æ—ç–∫—Ä–∞–Ω–Ω–æ–≥–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è —Å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å—é –ø–µ—Ä–µ–ª–∏—Å—Ç—ã–≤–∞–Ω–∏—è
function showFullscreenImage(placeName) {
    const images = placeImages[placeName];
    if (!images || images.length === 0) {
        showNotification('–§–æ—Ç–æ–≥—Ä–∞—Ñ–∏–∏ –¥–ª—è —ç—Ç–æ–≥–æ –∑–∞–≤–µ–¥–µ–Ω–∏—è —Å–∫–æ—Ä–æ –ø–æ—è–≤—è—Ç—Å—è! üì∏', 'error');
        return;
    }
    
    currentImages = images;
    currentImageIndex = 0;
    currentPlaceName = placeName;
    
    updateFullscreenImage();
    imageModal.classList.add('show');
    document.body.style.overflow = 'hidden';
}

// –§—É–Ω–∫—Ü–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –ø–æ–ª–Ω–æ—ç–∫—Ä–∞–Ω–Ω–æ–≥–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
function updateFullscreenImage() {
    if (currentImages.length === 0) return;
    
    fullscreenImage.src = currentImages[currentImageIndex];
    imageModalTitle.textContent = currentPlaceName;
    
    // –û–±–Ω–æ–≤–ª—è–µ–º —Å—á–µ—Ç—á–∏–∫
    currentImageElement.textContent = currentImageIndex + 1;
    totalImagesElement.textContent = currentImages.length;
    
    // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º/—Å–∫—Ä—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫–∏ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏
    prevImageBtn.classList.toggle('hidden', currentImages.length <= 1);
    nextImageBtn.classList.toggle('hidden', currentImages.length <= 1);
    
    // –°–∫—Ä—ã–≤–∞–µ–º —Å—á–µ—Ç—á–∏–∫ –µ—Å–ª–∏ —Ç–æ–ª—å–∫–æ –æ–¥–Ω–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ
    document.querySelector('.image-counter').style.display = 
        currentImages.length <= 1 ? 'none' : 'block';
}

// –§—É–Ω–∫—Ü–∏—è –ø–µ—Ä–µ—Ö–æ–¥–∞ –∫ —Å–ª–µ–¥—É—é—â–µ–º—É –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—é
function nextImage() {
    if (currentImages.length <= 1) return;
    
    currentImageIndex = (currentImageIndex + 1) % currentImages.length;
    updateFullscreenImage();
}

// –§—É–Ω–∫—Ü–∏—è –ø–µ—Ä–µ—Ö–æ–¥–∞ –∫ –ø—Ä–µ–¥—ã–¥—É—â–µ–º—É –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—é
function prevImage() {
    if (currentImages.length <= 1) return;
    
    currentImageIndex = (currentImageIndex - 1 + currentImages.length) % currentImages.length;
    updateFullscreenImage();
}

// –§—É–Ω–∫—Ü–∏—è —Å–∫—Ä—ã—Ç–∏—è –ø–æ–ª–Ω–æ—ç–∫—Ä–∞–Ω–Ω–æ–≥–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
function hideFullscreenImage() {
    imageModal.classList.remove('show');
    document.body.style.overflow = 'auto';
    fullscreenImage.src = '';
    currentImages = [];
    currentImageIndex = 0;
}

// –ê–Ω–∏–º–∞—Ü–∏–∏ –∫–∞—Ä—Ç–æ—á–µ–∫
function initCardAnimations() {
    const observerOptions = {
        threshold: 0.1,
        rootMargin: '0px 0px -50px 0px'
    };

    const observer = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
            if (entry.isIntersecting) {
                entry.target.style.opacity = '1';
                entry.target.style.transform = 'translateY(0)';
            }
        });
    }, observerOptions);

    const cards = document.querySelectorAll('.place-card');
    cards.forEach((card, index) => {
        card.style.opacity = '0';
        card.style.transform = 'translateY(30px)';
        card.style.transition = `all 0.6s cubic-bezier(0.4, 0, 0.2, 1) ${index * 0.1}s`;
        observer.observe(card);
    });
}

// –°–ò–°–¢–ï–ú–ê –ì–û–õ–û–°–û–í–ê–ù–ò–Ø

// –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∫–Ω–æ–ø–æ–∫ –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏—è
function setupVotingButtons() {
    document.addEventListener('click', (e) => {
        if (e.target.classList.contains('vote-btn') || e.target.closest('.vote-btn')) {
            const btn = e.target.classList.contains('vote-btn') ? e.target : e.target.closest('.vote-btn');
            const card = btn.closest('.place-card');
            const placeName = card.querySelector('.card-title').textContent;
            
            handleVote(placeName);
        }
        
        if (e.target.classList.contains('change-vote-btn') || e.target.closest('.change-vote-btn')) {
            showVotingModal();
        }
    });
}

// –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∫–Ω–æ–ø–æ–∫ –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏—è
function updateVoteButtons() {
    const voteButtons = document.querySelectorAll('.vote-btn');
    const currentUserVotes = votingData[currentUserKey] ? votingData[currentUserKey].votedFor : [];
    
    voteButtons.forEach(btn => {
        const card = btn.closest('.place-card');
        const placeName = card.querySelector('.card-title').textContent;
        const hasVoted = currentUserVotes.includes(placeName);
        
        if (hasVoted) {
            btn.classList.add('voted');
            btn.innerHTML = '<i class="fas fa-check"></i> –í–∞—à –≤—ã–±–æ—Ä';
        } else {
            btn.classList.remove('voted');
            btn.innerHTML = '<i class="fas fa-vote-yea"></i> –ì–æ–ª–æ—Å–æ–≤–∞—Ç—å';
        }
    });
}

// –†–µ–Ω–¥–µ—Ä–∏–Ω–≥ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏—è
function renderVotingResults() {
    console.log('üéØ –†–µ–Ω–¥–µ—Ä–∏–Ω–≥ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏—è...');
    renderChart();
    renderVotesList();
}

// –†–µ–Ω–¥–µ—Ä–∏–Ω–≥ –¥–∏–∞–≥—Ä–∞–º–º—ã
function renderChart() {
    const canvas = document.getElementById('votes-chart');
    if (!canvas) {
        console.log('‚ùå Canvas –Ω–µ –Ω–∞–π–¥–µ–Ω');
        return;
    }
    
    const ctx = canvas.getContext('2d');
    const container = canvas.parentElement;
    
    // –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Ä–∞–∑–º–µ—Ä—ã canvas
    canvas.width = container.clientWidth;
    canvas.height = container.clientHeight;
    
    // –û—á–∏—â–∞–µ–º canvas
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    
    console.log('üé® –†–µ–Ω–¥–µ—Ä–∏–º –¥–∏–∞–≥—Ä–∞–º–º—É —Å votingData:', votingData);
    
    // –°—á–∏—Ç–∞–µ–º –≥–æ–ª–æ—Å–∞ —Å –∑–∞—â–∏—Ç–æ–π –æ—Ç –æ—à–∏–±–æ–∫
    const voteCounts = {};
    
    if (votingData && typeof votingData === 'object') {
        Object.values(votingData).forEach(user => {
            if (user && user.votedFor && Array.isArray(user.votedFor)) {
                user.votedFor.forEach(place => {
                    if (place) {
                        voteCounts[place] = (voteCounts[place] || 0) + 1;
                    }
                });
            }
        });
    }
    
    console.log('üìä –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ–¥—Å—á–µ—Ç–∞:', voteCounts);
    
    // –°–æ—Ä—Ç–∏—Ä—É–µ–º –ø–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤—É –≥–æ–ª–æ—Å–æ–≤
    const sortedPlaces = Object.entries(voteCounts)
        .sort(([,a], [,b]) => b - a);
    
    // –û–±–Ω–æ–≤–ª—è–µ–º –æ–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –≥–æ–ª–æ—Å–æ–≤
    const totalVotes = Object.values(voteCounts).reduce((sum, count) => sum + count, 0);
    const totalVotesElement = document.getElementById('total-votes-count');
    if (totalVotesElement) {
        totalVotesElement.textContent = totalVotes;
    }
    
    if (sortedPlaces.length === 0) {
        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –∫–æ–≥–¥–∞ –Ω–µ—Ç –≥–æ–ª–æ—Å–æ–≤
        ctx.fillStyle = getComputedStyle(document.documentElement).getPropertyValue('--text-secondary');
        ctx.font = '16px Inter';
        ctx.textAlign = 'center';
        ctx.fillText('–ü–æ–∫–∞ –Ω–µ—Ç –≥–æ–ª–æ—Å–æ–≤. –ë—É–¥—å—Ç–µ –ø–µ—Ä–≤—ã–º!', canvas.width / 2, canvas.height / 2);
        return;
    }
    
    const maxVotes = Math.max(...Object.values(voteCounts));
    const barWidth = (canvas.width - 100) / sortedPlaces.length;
    const maxBarHeight = canvas.height - 120;
    
    // –†–∏—Å—É–µ–º —Å—Ç–æ–ª–±—Ü—ã
    sortedPlaces.forEach(([place, votes], index) => {
        const barHeight = (votes / maxVotes) * maxBarHeight;
        const x = 50 + index * barWidth;
        const y = canvas.height - 70 - barHeight;
        
        // –ì—Ä–∞–¥–∏–µ–Ω—Ç –¥–ª—è —Å—Ç–æ–ª–±—Ü–∞
        const gradient = ctx.createLinearGradient(x, y, x, y + barHeight);
        gradient.addColorStop(0, '#ff6b35');
        gradient.addColorStop(1, '#ff8c5a');
        
        // –°—Ç–æ–ª–±–µ—Ü
        ctx.fillStyle = gradient;
        ctx.fillRect(x, y, barWidth - 10, barHeight);
        
        // –¢–µ–Ω—å
        ctx.shadowColor = 'rgba(255, 107, 53, 0.3)';
        ctx.shadowBlur = 10;
        ctx.shadowOffsetY = 5;
        ctx.fillRect(x, y, barWidth - 10, barHeight);
        ctx.shadowColor = 'transparent';
        
        // –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –≥–æ–ª–æ—Å–æ–≤
        ctx.fillStyle = getComputedStyle(document.documentElement).getPropertyValue('--text-primary');
        ctx.font = 'bold 14px Inter';
        ctx.textAlign = 'center';
        ctx.fillText(votes, x + (barWidth - 10) / 2, y - 10);
        
        // –ù–∞–∑–≤–∞–Ω–∏–µ –º–µ—Å—Ç–∞ (—Å–æ–∫—Ä–∞—â–∞–µ–º –µ—Å–ª–∏ –¥–ª–∏–Ω–Ω–æ–µ)
        ctx.fillStyle = getComputedStyle(document.documentElement).getPropertyValue('--text-secondary');
        ctx.font = '12px Inter';
        let displayName = place;
        if (displayName.length > 15) {
            displayName = displayName.substring(0, 15) + '...';
        }
        ctx.fillText(displayName, x + (barWidth - 10) / 2, canvas.height - 40);
    });
}

// –†–µ–Ω–¥–µ—Ä–∏–Ω–≥ —Å–ø–∏—Å–∫–∞ –≥–æ–ª–æ—Å–æ–≤
function renderVotesList() {
    const container = document.getElementById('votes-list');
    if (!container) {
        console.log('‚ùå –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä —Å–ø–∏—Å–∫–∞ –≥–æ–ª–æ—Å–æ–≤ –Ω–µ –Ω–∞–π–¥–µ–Ω');
        return;
    }
    
    const searchTerm = document.getElementById('votes-search')?.value.toLowerCase() || '';
    
    let filteredUsers = votingData ? Object.entries(votingData) : [];
    
    // –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è –ø–æ –ø–æ–∏—Å–∫—É
    if (searchTerm) {
        filteredUsers = filteredUsers.filter(([key, user]) => {
            if (!user) return false;
            const userName = user.name || '';
            const userVotes = user.votedFor || [];
            return userName.toLowerCase().includes(searchTerm) ||
                   userVotes.some(place => place && place.toLowerCase().includes(searchTerm));
        });
    }
    
    console.log('üë• –†–µ–Ω–¥–µ—Ä–∏–º —Å–ø–∏—Å–æ–∫ –≥–æ–ª–æ—Å–æ–≤:', filteredUsers);
    
    if (filteredUsers.length === 0) {
        container.innerHTML = `
            <div class="no-votes" style="text-align: center; padding: 2rem; color: var(--text-muted);">
                <i class="fas fa-users" style="font-size: 3rem; margin-bottom: 1rem; opacity: 0.5;"></i>
                <p>${searchTerm ? '–ù–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ' : '–ü–æ–∫–∞ –Ω–∏–∫—Ç–æ –Ω–µ –ø—Ä–æ–≥–æ–ª–æ—Å–æ–≤–∞–ª'}</p>
            </div>
        `;
        return;
    }
    
    container.innerHTML = filteredUsers.map(([key, user]) => {
        if (!user) return '';
        
        const userVotes = user.votedFor || [];
        
        return `
            <div class="vote-item">
                <div class="voter-avatar">${user.avatar || '?'}</div>
                <div class="voter-info">
                    <div class="voter-name">${user.name || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π'}</div>
                    <div class="voter-role">${user.role || '–£—á–µ–Ω–∏–∫'}</div>
                    ${userVotes.length > 0 ? `
                        <div class="vote-selection">
                            ${userVotes.map(place => `
                                <span class="voted-place">
                                    <i class="fas fa-map-marker-alt"></i>
                                    ${place}
                                </span>
                            `).join('')}
                        </div>
                    ` : '<div class="vote-selection" style="color: var(--text-muted); font-size: 0.9rem;">–ï—â—ë –Ω–µ –≥–æ–ª–æ—Å–æ–≤–∞–ª</div>'}
                </div>
                ${key === currentUserKey ? `
                    <div class="vote-actions">
                        <button class="change-vote-btn">
                            <i class="fas fa-edit"></i>
                            –ò–∑–º–µ–Ω–∏—Ç—å
                        </button>
                    </div>
                ` : ''}
            </div>
        `;
    }).join('');
}

// –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è –≥–æ–ª–æ—Å–æ–≤
function showVotingModal() {
    const currentUserVotes = votingData[currentUserKey] ? votingData[currentUserKey].votedFor : [];
    
    let modalHTML = `
        <div class="image-modal show" id="voting-modal">
            <div class="image-modal-content" style="max-width: 600px;">
                <button class="close-image-btn" onclick="hideVotingModal()">
                    <i class="fas fa-times"></i>
                </button>
                <div style="padding: 2rem;">
                    <h2 style="font-family: 'Playfair Display', serif; margin-bottom: 1.5rem; text-align: center;">
                        –í–∞—à–∏ –≥–æ–ª–æ—Å–∞
                    </h2>
                    <div style="margin-bottom: 2rem; color: var(--text-secondary); text-align: center;">
                        –í—ã–±–µ—Ä–∏—Ç–µ –∑–∞–≤–µ–¥–µ–Ω–∏—è, –∫–æ—Ç–æ—Ä—ã–µ –≤–∞–º –Ω—Ä–∞–≤—è—Ç—Å—è
                    </div>
                    <div class="voting-options" style="display: grid; gap: 1rem; max-height: 400px; overflow-y: auto;">
    `;
    
    Object.keys(placesData).forEach(placeName => {
        const isVoted = currentUserVotes.includes(placeName);
        modalHTML += `
            <div class="voting-option" style="display: flex; align-items: center; gap: 1rem; padding: 1rem; background: rgba(255,255,255,0.03); border-radius: 12px; border: 1px solid ${isVoted ? 'var(--accent)' : 'var(--border)'};">
                <label style="display: flex; align-items: center; gap: 1rem; cursor: pointer; flex: 1;">
                    <input type="checkbox" ${isVoted ? 'checked' : ''} value="${placeName}" 
                           style="accent-color: var(--accent); transform: scale(1.2);">
                    <span style="color: var(--text-primary); font-weight: 500;">${placeName}</span>
                </label>
            </div>
        `;
    });
    
    modalHTML += `
                    </div>
                    <div style="display: flex; gap: 1rem; margin-top: 2rem;">
                        <button onclick="hideVotingModal()" style="flex: 1; padding: 1rem; background: rgba(255,255,255,0.05); border: 1px solid var(--border); color: var(--text-primary); border-radius: 8px; cursor: pointer;">
                            –û—Ç–º–µ–Ω–∞
                        </button>
                        <button onclick="saveVotesFromModal()" style="flex: 1; padding: 1rem; background: var(--gradient-primary); border: none; color: white; border-radius: 8px; cursor: pointer; font-weight: 600;">
                            –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤—ã–±–æ—Ä
                        </button>
                    </div>
                </div>
            </div>
        </div>
    `;
    
    // –î–æ–±–∞–≤–ª—è–µ–º –º–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –≤ body
    const modalContainer = document.createElement('div');
    modalContainer.innerHTML = modalHTML;
    document.body.appendChild(modalContainer);
    document.body.style.overflow = 'hidden';
}

function hideVotingModal() {
    const modal = document.getElementById('voting-modal');
    if (modal) {
        modal.remove();
    }
    document.body.style.overflow = 'auto';
}

function saveVotesFromModal() {
    const checkboxes = document.querySelectorAll('.voting-option input[type="checkbox"]:checked');
    const selectedPlaces = Array.from(checkboxes).map(cb => cb.value);
    
    if (!votingData[currentUserKey]) {
        const currentUser = users[currentUserKey];
        votingData[currentUserKey] = {
            name: currentUser.name,
            role: currentUser.role,
            avatar: currentUser.avatar,
            votedFor: []
        };
    }
    
    votingData[currentUserKey].votedFor = selectedPlaces;
    
    // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ Firebase
    saveVoteToFirebase(currentUserKey, votingData[currentUserKey]);
    hideVotingModal();
    showNotification('–í–∞—à–∏ –≥–æ–ª–æ—Å–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã! üó≥Ô∏è', 'success');
}

// –ü–æ–∏—Å–∫ –≤ —Å–ø–∏—Å–∫–µ –≥–æ–ª–æ—Å–æ–≤
function setupVotesSearch() {
    const searchInput = document.getElementById('votes-search');
    if (searchInput) {
        searchInput.addEventListener('input', renderVotesList);
    }
}

// –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π
loginBtn.addEventListener('click', login);

accessKeyInput.addEventListener('keypress', (e) => {
    if (e.key === 'Enter') {
        login();
    }
});

logoutBtn.addEventListener('click', logout);

closeMapModal.addEventListener('click', hideMap);

closeImageModal.addEventListener('click', hideFullscreenImage);

prevImageBtn.addEventListener('click', prevImage);
nextImageBtn.addEventListener('click', nextImage);

// –ó–∞–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª—å–Ω—ã—Ö –æ–∫–æ–Ω –ø—Ä–∏ –∫–ª–∏–∫–µ –≤–Ω–µ –∏—Ö
mapModal.addEventListener('click', (e) => {
    if (e.target === mapModal) {
        hideMap();
    }
});

imageModal.addEventListener('click', (e) => {
    if (e.target === imageModal) {
        hideFullscreenImage();
    }
});

// –ó–∞–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª—å–Ω—ã—Ö –æ–∫–æ–Ω –ø–æ ESC –∏ –Ω–∞–≤–∏–≥–∞—Ü–∏—è –ø–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è–º
document.addEventListener('keydown', (e) => {
    if (e.key === 'Escape') {
        if (mapModal.classList.contains('show')) {
            hideMap();
        }
        if (imageModal.classList.contains('show')) {
            hideFullscreenImage();
        }
        
        // –ó–∞–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏—è
        const votingModal = document.getElementById('voting-modal');
        if (votingModal) {
            hideVotingModal();
        }
    }
    
    // –ù–∞–≤–∏–≥–∞—Ü–∏—è –ø–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è–º —Å –ø–æ–º–æ—â—å—é –∫–ª–∞–≤–∏—à
    if (imageModal.classList.contains('show')) {
        if (e.key === 'ArrowLeft') {
            prevImage();
        } else if (e.key === 'ArrowRight') {
            nextImage();
        }
    }
});

// –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –∫–Ω–æ–ø–æ–∫ –¥–µ–π—Å—Ç–≤–∏–π
document.addEventListener('click', (e) => {
    // –ö–Ω–æ–ø–∫–∞ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è —Ñ–æ—Ç–æ/–∏–∫–æ–Ω–∫–∏
    if (e.target.classList.contains('toggle-image-btn') || 
        e.target.closest('.toggle-image-btn')) {
        const btn = e.target.classList.contains('toggle-image-btn') ? 
                   e.target : e.target.closest('.toggle-image-btn');
        const card = btn.closest('.place-card');
        toggleImage(card);
    }
    
    // –ö–Ω–æ–ø–∫–∞ —Ä–∞–∑–≤–µ—Ä–Ω—É—Ç—å —Ñ–æ—Ç–æ (—Ç–µ–ø–µ—Ä—å –≤ –ª–µ–≤–æ–º –≤–µ—Ä—Ö–Ω–µ–º —É–≥–ª—É)
    if (e.target.classList.contains('expand-image-btn') || 
        e.target.closest('.expand-image-btn')) {
        const btn = e.target.classList.contains('expand-image-btn') ? 
                   e.target : e.target.closest('.expand-image-btn');
        const card = btn.closest('.place-card');
        const placeName = card.querySelector('.card-title').textContent;
        showFullscreenImage(placeName);
    }
    
    // –û—Å—Ç–∞–ª—å–Ω—ã–µ –∫–Ω–æ–ø–∫–∏ –¥–µ–π—Å—Ç–≤–∏–π
    if (e.target.classList.contains('action-btn') || 
        e.target.closest('.action-btn')) {
        const btn = e.target.classList.contains('action-btn') ? e.target : e.target.closest('.action-btn');
        const card = btn.closest('.place-card');
        const placeName = card.querySelector('.card-title').textContent;
        const place = placesData[placeName];
        
        if (btn.classList.contains('primary')) {
            if (btn.querySelector('.fa-vk') && place.social) {
                // –û—Ç–∫—Ä—ã–≤–∞–µ–º VK
                if (place.social.includes('vk.com')) {
                    window.open(`https://${place.social}`, '_blank');
                } else {
                    window.open(place.social, '_blank');
                }
            } else if (btn.querySelector('.fa-globe') && place.social) {
                // –û—Ç–∫—Ä—ã–≤–∞–µ–º —Å–∞–π—Ç
                window.open(`https://${place.social}`, '_blank');
            } else if (btn.querySelector('.fa-phone') && place.phone) {
                // –ó–≤–æ–Ω–æ–∫
                window.open(`tel:${place.phone.replace(/[^0-9+]/g, '')}`, '_self');
            } else {
                showNotification('–ö–æ–Ω—Ç–∞–∫—Ç–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è —Å–∫–æ—Ä–æ –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–Ω–∞! üìû');
            }
        } else if (btn.querySelector('.fa-map-marker-alt') || btn.textContent.includes('–∫–∞—Ä—Ç–µ')) {
            showMap(placeName);
        } else {
            showNotification('–§—É–Ω–∫—Ü–∏—è —Å–∫–æ—Ä–æ –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–Ω–∞! ‚ö°');
        }
    }
});

// –ê–Ω–∏–º–∞—Ü–∏—è —Ç—Ä—è—Å–∫–∏ –¥–ª—è –æ—à–∏–±–æ–∫
const style = document.createElement('style');
style.textContent = `
    @keyframes shake {
        0%, 100% { transform: translateX(0); }
        25% { transform: translateX(-5px); }
        75% { transform: translateX(5px); }
    }
`;
document.head.appendChild(style);

// –£–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä—ã–π –∏–Ω—Ç–µ—Ä–≤–∞–ª –∞–≤—Ç–æ-–æ–±–Ω–æ–≤–ª–µ–Ω–∏—è, —Ç–∞–∫ –∫–∞–∫ Firebase –æ–±–Ω–æ–≤–ª—è–µ—Ç –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
// –í–º–µ—Å—Ç–æ —ç—Ç–æ–≥–æ –∏—Å–ø–æ–ª—å–∑—É–µ–º —Å–ª—É—à–∞—Ç–µ–ª—å Firebase –≤ loadVotingDataFromFirebase

// –ü–æ–∫–∞–∑ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –Ω–æ–≤–æ–º –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏–∏
window.addEventListener('storage', (e) => {
    if (e.key === 'sborVotingData') {
        showNotification('–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω—ã! üîÑ', 'success');
        loadVotingDataFromFirebase();
        renderVotingResults();
        updateVoteButtons();
    }
});

// –ö–æ–Ω—Å–æ–ª—å–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
console.log('üå≤ –ü—Ä–µ–º–∏—É–º –≥–∏–¥ –°–æ—Å–Ω–æ–≤—ã–π –ë–æ—Ä - –î–æ—Å—Ç—É–ø–Ω—ã–µ –∫–ª—é—á–∏:');
console.log('‚≠ê –û—Å–æ–±—ã–µ –∫–ª—é—á–∏:');
console.log('   B4G5R6T7 - –ë–µ–±–∏—è –ë–∞–≥—Ä–∞—Ç (–í–ª–∞–¥–µ–ª–µ—Ü —Å–∞–π—Ç–∞)');
console.log('   L1A2R3I4 - –ê–ª–±–∞–µ–≤–∞ –õ–∞—Ä–∏—Å–∞ –ö–∞–¥—ã—Ä–æ–≤–Ω–∞ (–£—á–∏—Ç–µ–ª—å)');
console.log('');
console.log('üè™ –î–æ—Å—Ç—É–ø–Ω—ã–µ –º–µ—Å—Ç–∞ –Ω–∞ –∫–∞—Ä—Ç–µ:');
Object.keys(placesData).forEach(place => {
    console.log(`   üìç ${place} - ${placesData[place].address}`);
});
console.log('');
console.log('üó≥Ô∏è –°–∏—Å—Ç–µ–º–∞ –≥–æ–ª–æ—Å–æ–≤–∞–Ω–∏—è —Å Firebase –∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω–∞!');
console.log('–î–æ—Å—Ç—É–ø–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã:');
console.log('   - showVotingModal() - –æ—Ç–∫—Ä—ã—Ç—å –æ–∫–Ω–æ –≤—ã–±–æ—Ä–∞ –≥–æ–ª–æ—Å–æ–≤');
console.log('   - renderVotingResults() - –ø–µ—Ä–µ—Ä–∏—Å–æ–≤–∞—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã');
